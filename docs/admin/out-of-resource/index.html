

<!Doctype html>
<html id="docs" class="Guides">


<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="canonical" href="http://kubernetes.io/docs/admin/out-of-resource/" />
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
        <link rel="stylesheet" href="/css/jquery-ui.min.css">
        <link rel="stylesheet" href="/css/sweetalert.css">
	<script src="/js/jquery-2.2.0.min.js"></script>
        <script src="/js/jquery-ui.min.js"></script>
	<script src="/js/script.js"></script>
        <script src="/js/sweetalert.min.js"></script>
	<title>Kubernetes - Configuring Out Of Resource Handling</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a>
		<a href="/docs/hellonode/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/hellonode/">Get Started</a></h3>
				<p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
				<p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
			</div>
			<div class="nav-box">
				<h3><a href="/community/">Community</a></h3>
				<p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.kubernetes.io">Blog</a></h3>
				<p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
	<h1>Guides</h1>
	<h5>How to get started, and achieve tasks, using Kubernetes</h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/docs/" class="YAH">GUIDES</a></li>
			<li><a href="/docs/reference" >REFERENCE</a></li>
			<li><a href="/docs/samples" >SAMPLES</a></li>
			<li><a href="/docs/troubleshooting/" >SUPPORT</a></li>
		</ul>
		<div id="searchBox">
			<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
		</div>
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
        
    <a class="item" data-title="Guides" href="/docs/"></a>
<div class="item" data-title="Getting Started">
  <div class="container">
    <a class="item" data-title="What is Kubernetes?" href="/docs/whatisk8s/"></a>
    <a class="item" data-title="Downloading or Building Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    <a class="item" data-title="Hello World Walkthrough" href="/docs/hellonode/"></a>
    <a class="item" data-title="Online Training Course" href="https://www.udacity.com/course/scalable-microservices-with-kubernetes--ud615" target='_blank'></a>
  </div>
</div>
<div class="item" data-title="Accessing the Cluster">
  <div class="container">
    <a class="item" data-title="Installing and Setting up kubectl" href="/docs/user-guide/prereqs/"></a>
    <a class="item" data-title="Accessing Clusters" href="/docs/user-guide/accessing-the-cluster/"></a>
    <a class="item" data-title="Sharing Cluster Access with kubeconfig" href="/docs/user-guide/sharing-clusters/"></a>
    <a class="item" data-title="Authenticating Across Clusters with kubeconfig" href="/docs/user-guide/kubeconfig-file/"></a>
  </div>
</div>
    <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    <a class="item" data-title="Web UI (Dashboard)" href="/docs/user-guide/ui/"></a>
<div class="item" data-title="Workload Deployment and Management">
  <div class="container">
    <a class="item" data-title="Launching, Exposing, and Killing Applications" href="/docs/user-guide/quick-start/"></a>
    <a class="item" data-title="Deploying Applications" href="/docs/user-guide/deploying-applications/"></a>
    <a class="item" data-title="Managing Resources" href="/docs/user-guide/managing-deployments/"></a>
    <a class="item" data-title="Replication Controller Operations" href="/docs/user-guide/replication-controller/operations/"></a>
    <a class="item" data-title="Resizing a Replication Controller" href="/docs/user-guide/resizing-a-replication-controller/"></a>
    <a class="item" data-title="Rolling Updates" href="/docs/user-guide/rolling-updates/"></a>
    <a class="item" data-title="Rolling Update Demo" href="/docs/user-guide/update-demo/"></a>
    <a class="item" data-title="Secrets Walkthrough" href="/docs/user-guide/secrets/walkthrough/"></a>
    <a class="item" data-title="Using ConfigMap" href="/docs/user-guide/configmap/"></a>
    <a class="item" data-title="Horizontal Pod Autoscaling" href="/docs/user-guide/horizontal-pod-autoscaling/walkthrough/"></a>
    <a class="item" data-title="Best Practices for Configuration" href="/docs/user-guide/config-best-practices/"></a>
    <a class="item" data-title="Using kubectl to Manage Resources" href="/docs/user-guide/working-with-resources/"></a>
    <a class="item" data-title="Garbage collection" href="/docs/user-guide/garbage-collector/"></a>
  </div>
</div>
<div class="item" data-title="Batch Jobs">
  <div class="container">
    <a class="item" data-title="Jobs" href="/docs/user-guide/jobs/"></a>
    <a class="item" data-title="Parallel Processing using Expansions" href="/docs/user-guide/jobs/expansions/"></a>
    <a class="item" data-title="Coarse Parallel Processing using a Work Queue" href="/docs/user-guide/jobs/work-queue-1/"></a>
    <a class="item" data-title="Fine Parallel Processing using a Work Queue" href="/docs/user-guide/jobs/work-queue-2/"></a>
  </div>
</div>
<div class="item" data-title="Service Discovery and Load Balancing">
  <div class="container">
    <a class="item" data-title="Connecting Applications with Services" href="/docs/user-guide/connecting-applications/"></a>
    <a class="item" data-title="Service Operations" href="/docs/user-guide/services/operations/"></a>
    <a class="item" data-title="Creating an External Load Balancer" href="/docs/user-guide/load-balancer/"></a>
    <a class="item" data-title="Configuring Your Cloud Provider's Firewalls" href="/docs/user-guide/services-firewalls/"></a>
    <a class="item" data-title="Cross-cluster Service Discovery using Federated Services" href="/docs/user-guide/federation/federated-services/"></a>
  </div>
</div>
<div class="item" data-title="Containers and Pods">
  <div class="container">
    <a class="item" data-title="Running Your First Containers" href="/docs/user-guide/simple-nginx/"></a>
    <a class="item" data-title="Creating Single-Container Pods" href="/docs/user-guide/pods/single-container/"></a>
    <a class="item" data-title="Creating Multi-Container Pods" href="/docs/user-guide/pods/multi-container/"></a>
    <a class="item" data-title="Configuring Containers" href="/docs/user-guide/configuring-containers/"></a>
    <a class="item" data-title="Working with Containers in Production" href="/docs/user-guide/production-pods/"></a>
    <a class="item" data-title="Commands and Capabilities" href="/docs/user-guide/containers/"></a>
    <a class="item" data-title="Using Environment Variables" href="/docs/user-guide/environment-guide/"></a>
    <a class="item" data-title="Managing Compute Resources" href="/docs/user-guide/compute-resources/"></a>
    <a class="item" data-title="The Lifecycle of a Pod" href="/docs/user-guide/pod-states/"></a>
    <a class="item" data-title="Checking Pod Health" href="/docs/user-guide/liveness/"></a>
    <a class="item" data-title="Container Lifecycle Hooks" href="/docs/user-guide/container-environment/"></a>
    <a class="item" data-title="Assigning Pods to Nodes" href="/docs/user-guide/node-selection/"></a>
    <a class="item" data-title="Using the Downward API to Convey Pod Properties" href="/docs/user-guide/downward-api/"></a>
    <a class="item" data-title="Downward API Volumes" href="/docs/user-guide/downward-api/volume"></a>
    <a class="item" data-title="Persistent Volumes Walkthrough" href="/docs/user-guide/persistent-volumes/walkthrough/"></a>
    <a class="item" data-title="Bootstrapping Pet Sets" href="/docs/user-guide/petset/bootstrapping/"></a>
  </div>
</div>
<div class="item" data-title="Monitoring, Logging, and Debugging Containers">
  <div class="container">
    <a class="item" data-title="Resource Usage Monitoring" href="/docs/user-guide/monitoring/"></a>
    <a class="item" data-title="Logging" href="/docs/getting-started-guides/logging/"></a>
    <a class="item" data-title="Logging with Elasticsearch and Kibana" href="/docs/getting-started-guides/logging-elasticsearch/"></a>
    <a class="item" data-title="Running Commands in a Container with kubectl exec" href="/docs/user-guide/getting-into-containers/"></a>
    <a class="item" data-title="Connect with Proxies" href="/docs/user-guide/connecting-to-applications-proxy/"></a>
    <a class="item" data-title="Connect with Port Forwarding" href="/docs/user-guide/connecting-to-applications-port-forward/"></a>
    <a class="item" data-title="Using Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/explorer" target='_blank'></a>
  </div>
</div>
<div class="item" data-title="Creating a Cluster">
  <div class="container">
    <a class="item" data-title="Picking the Right Solution" href="/docs/getting-started-guides/"></a>
<div class="item" data-title="Running Kubernetes on Your Local Machine">
  <div class="container">
    <a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/getting-started-guides/minikube/"></a>
    <a class="item" data-title="Deprecated Alternatives" href="/docs/getting-started-guides/alternatives/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Turn-key Cloud Solutions">
  <div class="container">
    <a class="item" data-title="Running Kubernetes on Google Container Engine" href="https://cloud.google.com/container-engine/docs/before-you-begin/" target='_blank'></a>
    <a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/getting-started-guides/gce/"></a>
    <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    <a class="item" data-title="Running Kubernetes on Azure (Weave-based)" href="/docs/getting-started-guides/coreos/azure/"></a>
    <a class="item" data-title="Running Kubernetes on Azure (Flannel-based)" href="/docs/getting-started-guides/azure/"></a>
    <a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/getting-started-guides/clc/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Custom Solutions">
  <div class="container">
    <a class="item" data-title="Creating a Custom Cluster from Scratch" href="/docs/getting-started-guides/scratch/"></a>
<div class="item" data-title="Custom Cloud Solutions">
  <div class="container">
    <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Ubuntu on AWS or Joyent" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="CoreOS on Rackspace" href="/docs/getting-started-guides/rackspace/"></a>
  </div>
</div>
<div class="item" data-title="On-Premise VMs">
  <div class="container">
    <a class="item" data-title="CoreOS on Vagrant" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    <a class="item" data-title="VMware vSphere" href="/docs/getting-started-guides/vsphere/"></a>
    <a class="item" data-title="VMware Photon Controller" href="/docs/getting-started-guides/photon-controller/"></a>
    <a class="item" data-title="Juju" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    <a class="item" data-title="CoreOS on libvirt" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    <a class="item" data-title="OpenStack Heat" href="/docs/getting-started-guides/openstack-heat/"></a>
    <a class="item" data-title="CoreOS on Multinode Cluster" href="/docs/getting-started-guides/coreos/coreos_multinode_cluster/"></a>
    <a class="item" data-title="Fedora With Calico Networking" href="/docs/getting-started-guides/fedora/fedora-calico/"></a>
<div class="item" data-title="rkt">
  <div class="container">
    <a class="item" data-title="Running Kubernetes with rkt" href="/docs/getting-started-guides/rkt/"></a>
    <a class="item" data-title="Known Issues when Using rkt" href="/docs/getting-started-guides/rkt/notes/"></a>
  </div>
</div>
    <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
  </div>
</div>
<div class="item" data-title="Bare Metal">
  <div class="container">
    <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="CentOS" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    <a class="item" data-title="CoreOS" href="/docs/getting-started-guides/coreos"></a>
    <a class="item" data-title="CoreOS with Calico" href="/docs/getting-started-guides/coreos/bare_metal_calico/"></a>
    <a class="item" data-title="Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    <a class="item" data-title="Ubuntu Nodes with Calico" href="/docs/getting-started-guides/ubuntu-calico/"></a>
  </div>
</div>
  </div>
</div>
    <a class="item" data-title="Portable Multi-Node Cluster" href="/docs/getting-started-guides/docker-multinode/"></a>
    <a class="item" data-title="Building Large Clusters" href="/docs/admin/cluster-large/"></a>
    <a class="item" data-title="Running in Multiple Zones" href="/docs/admin/multiple-zones/"></a>
    <a class="item" data-title="Building High-Availability Clusters" href="/docs/admin/high-availability/"></a>
  </div>
</div>
<div class="item" data-title="Administering Clusters">
  <div class="container">
    <a class="item" data-title="Admin Guide" href="/docs/admin/"></a>
    <a class="item" data-title="Cluster Management Guide" href="/docs/admin/cluster-management/"></a>
    <a class="item" data-title="Sharing a Cluster with Namespaces" href="/docs/admin/namespaces/"></a>
    <a class="item" data-title="Namespaces Walkthrough" href="/docs/admin/namespaces/walkthrough/"></a>
    <a class="item" data-title="Setting Pod CPU and Memory Limits" href="/docs/admin/limitrange/"></a>
    <a class="item" data-title="Understanding Resource Quotas" href="/docs/admin/resourcequota/"></a>
    <a class="item" data-title="Applying Resource Quotas and Limits" href="/docs/admin/resourcequota/walkthrough/"></a>
    <a class="item" data-title="Kubernetes Components" href="/docs/admin/cluster-components/"></a>
    <a class="item" data-title="Configuring Kubernetes Use of etcd" href="/docs/admin/etcd/"></a>
    <a class="item" data-title="Federating Clusters" href="/docs/admin/federation/"></a>
    <a class="item" data-title="Using Multiple Clusters" href="/docs/admin/multi-cluster/"></a>
    <a class="item" data-title="Changing Cluster Size" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ#how-do-i-change-the-size-of-my-cluster/" target='_blank'></a>
    <a class="item" data-title="Configuring Multiple Schedulers" href="/docs/admin/multiple-schedulers/"></a>
    <a class="item" data-title="Networking in Kubernetes" href="/docs/admin/networking/"></a>
    <a class="item" data-title="Using DNS Pods and Services" href="/docs/admin/dns/"></a>
    <a class="item" data-title="Setting Up and Configuring DNS" href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/cluster-dns" target='_blank'></a>
    <a class="item" data-title="Master <-> Node Communication" href="/docs/admin/master-node-communication/"></a>
    <a class="item" data-title="Network Plugins" href="/docs/admin/network-plugins/"></a>
    <a class="item" data-title="Static Pods" href="/docs/admin/static-pods/"></a>
    <a class="item" data-title="Configuring kubelet Garbage Collection" href="/docs/admin/garbage-collection/"></a>
    <a class="item" data-title="Configuring Out Of Resource Handling" href="/docs/admin/out-of-resource/"></a>
    <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    <a class="item" data-title="Monitoring Node Health" href="/docs/admin/node-problem/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
		<button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
	</div> <!-- /docsToc -->
	<div id="docsContent">
        <p><a href="/editdocs#docs/admin/out-of-resource.md" id="editPageButton">Edit This Page</a></p>
    	<h1>Configuring Out Of Resource Handling</h1>
		<ul id="markdown-toc">
  <li><a href="#eviction-policy" id="markdown-toc-eviction-policy">Eviction Policy</a>    <ul>
      <li><a href="#eviction-signals" id="markdown-toc-eviction-signals">Eviction Signals</a></li>
      <li><a href="#eviction-thresholds" id="markdown-toc-eviction-thresholds">Eviction Thresholds</a>        <ul>
          <li><a href="#soft-eviction-thresholds" id="markdown-toc-soft-eviction-thresholds">Soft Eviction Thresholds</a></li>
          <li><a href="#hard-eviction-thresholds" id="markdown-toc-hard-eviction-thresholds">Hard Eviction Thresholds</a></li>
        </ul>
      </li>
      <li><a href="#eviction-monitoring-interval" id="markdown-toc-eviction-monitoring-interval">Eviction Monitoring Interval</a></li>
      <li><a href="#node-conditions" id="markdown-toc-node-conditions">Node Conditions</a></li>
      <li><a href="#oscillation-of-node-conditions" id="markdown-toc-oscillation-of-node-conditions">Oscillation of node conditions</a></li>
      <li><a href="#eviction-of-pods" id="markdown-toc-eviction-of-pods">Eviction of Pods</a></li>
      <li><a href="#scheduler" id="markdown-toc-scheduler">Scheduler</a></li>
    </ul>
  </li>
  <li><a href="#node-oom-behavior" id="markdown-toc-node-oom-behavior">Node OOM Behavior</a></li>
  <li><a href="#best-practices" id="markdown-toc-best-practices">Best Practices</a>    <ul>
      <li><a href="#schedulable-resources-and-eviction-policies" id="markdown-toc-schedulable-resources-and-eviction-policies">Schedulable resources and eviction policies</a></li>
      <li><a href="#daemonset" id="markdown-toc-daemonset">DaemonSet</a></li>
    </ul>
  </li>
</ul>

<p>The <code class="highlighter-rouge">kubelet</code> needs to preserve node stability when available compute resources are low.</p>

<p>This is especially important when dealing with incompressible resources such as memory or disk.</p>

<p>If either resource is exhausted, the node would become unstable.</p>

<h2 id="eviction-policy">Eviction Policy</h2>

<p>The <code class="highlighter-rouge">kubelet</code> can pro-actively monitor for and prevent against total starvation of a compute resource.  In
cases where it could appear to occur, the <code class="highlighter-rouge">kubelet</code> can pro-actively fail one or more pods in order to reclaim
the starved resource.  When the <code class="highlighter-rouge">kubelet</code> fails a pod, it terminates all containers in the pod, and the <code class="highlighter-rouge">PodPhase</code>
is transitioned to <code class="highlighter-rouge">Failed</code>.</p>

<h3 id="eviction-signals">Eviction Signals</h3>

<p>The <code class="highlighter-rouge">kubelet</code> can support the ability to trigger eviction decisions on the signals described in the
table below.  The value of each signal is described in the description column based on the <code class="highlighter-rouge">kubelet</code>
summary API.</p>

<table>
  <thead>
    <tr>
      <th>Eviction Signal</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">memory.available</code></td>
      <td><code class="highlighter-rouge">memory.available</code> := <code class="highlighter-rouge">node.status.capacity[memory]</code> - <code class="highlighter-rouge">node.stats.memory.workingSet</code></td>
    </tr>
  </tbody>
</table>

<p>In future releases, the <code class="highlighter-rouge">kubelet</code> will support the ability to trigger eviction decisions based on disk pressure.</p>

<p>Until that time, it is recommended users take advantage of <a href="/docs/admin/garbage-collection/">garbage collection</a>.</p>

<h3 id="eviction-thresholds">Eviction Thresholds</h3>

<p>The <code class="highlighter-rouge">kubelet</code> supports the ability to specify eviction thresholds that trigger the <code class="highlighter-rouge">kubelet</code> to reclaim resources.</p>

<p>Each threshold is of the following form:</p>

<p><code class="highlighter-rouge">&lt;eviction-signal&gt;&lt;operator&gt;&lt;quantity&gt;</code></p>

<ul>
  <li>valid <code class="highlighter-rouge">eviction-signal</code> tokens as defined above.</li>
  <li>valid <code class="highlighter-rouge">operator</code> tokens are <code class="highlighter-rouge">&lt;</code></li>
  <li>valid <code class="highlighter-rouge">quantity</code> tokens must match the quantity representation used by Kubernetes</li>
</ul>

<h4 id="soft-eviction-thresholds">Soft Eviction Thresholds</h4>

<p>A soft eviction threshold pairs an eviction threshold with a required
administrator specified grace period.  No action is taken by the <code class="highlighter-rouge">kubelet</code>
to reclaim resources associated with the eviction signal until that grace
period has been exceeded.  If no grace period is provided, the <code class="highlighter-rouge">kubelet</code> will
error on startup.</p>

<p>In addition, if a soft eviction threshold has been met, an operator can
specify a maximum allowed pod termination grace period to use when evicting
pods from the node.  If specified, the <code class="highlighter-rouge">kubelet</code> will use the lesser value among
the <code class="highlighter-rouge">pod.Spec.TerminationGracePeriodSeconds</code> and the max allowed grace period.
If not specified, the <code class="highlighter-rouge">kubelet</code> will kill pods immediately with no graceful
termination.</p>

<p>To configure soft eviction thresholds, the following flags are supported:</p>

<ul>
  <li><code class="highlighter-rouge">eviction-soft</code> describes a set of eviction thresholds (e.g. <code class="highlighter-rouge">memory.available&lt;1.5Gi</code>) that if met over a
corresponding grace period would trigger a pod eviction.</li>
  <li><code class="highlighter-rouge">eviction-soft-grace-period</code> describes a set of eviction grace periods (e.g. <code class="highlighter-rouge">memory.available=1m30s</code>) that
correspond to how long a soft eviction threshold must hold before triggering a pod eviction.</li>
  <li><code class="highlighter-rouge">eviction-max-pod-grace-period</code> describes the maximum allowed grace period (in seconds) to use when terminating
pods in response to a soft eviction threshold being met.</li>
</ul>

<h4 id="hard-eviction-thresholds">Hard Eviction Thresholds</h4>

<p>A hard eviction threshold has no grace period, and if observed, the <code class="highlighter-rouge">kubelet</code>
will take immediate action to reclaim the associated starved resource.  If a
hard eviction threshold is met, the <code class="highlighter-rouge">kubelet</code> will kill the pod immediately
with no graceful termination.</p>

<p>To configure hard eviction thresholds, the following flag is supported:</p>

<ul>
  <li><code class="highlighter-rouge">eviction-hard</code> describes a set of eviction thresholds (e.g. <code class="highlighter-rouge">memory.available&lt;1Gi</code>) that if met
would trigger a pod eviction.</li>
</ul>

<h3 id="eviction-monitoring-interval">Eviction Monitoring Interval</h3>

<p>The <code class="highlighter-rouge">kubelet</code> evaluates eviction thresholds per its configured housekeeping interval.</p>

<ul>
  <li><code class="highlighter-rouge">housekeeping-interval</code> is the interval between container housekeepings.</li>
</ul>

<h3 id="node-conditions">Node Conditions</h3>

<p>The <code class="highlighter-rouge">kubelet</code> will map one or more eviction signals to a corresponding node condition.</p>

<p>If a hard eviction threshold has been met, or a soft eviction threshold has been met
independent of its associated grace period, the <code class="highlighter-rouge">kubelet</code> will report a condition that
reflects the node is under pressure.</p>

<p>The following node conditions are defined that correspond to the specified eviction signal.</p>

<table>
  <thead>
    <tr>
      <th>Node Condition</th>
      <th>Eviction Signal</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">MemoryPressure</code></td>
      <td><code class="highlighter-rouge">memory.available</code></td>
      <td>Available memory on the node has satisfied an eviction threshold</td>
    </tr>
  </tbody>
</table>

<p>The <code class="highlighter-rouge">kubelet</code> will continue to report node status updates at the frequency specified by
<code class="highlighter-rouge">--node-status-update-frequency</code> which defaults to <code class="highlighter-rouge">10s</code>.</p>

<h3 id="oscillation-of-node-conditions">Oscillation of node conditions</h3>

<p>If a node is oscillating above and below a soft eviction threshold, but not exceeding
its associated grace period, it would cause the corresponding node condition to
constantly oscillate between true and false, and could cause poor scheduling decisions
as a consequence.</p>

<p>To protect against this oscillation, the following flag is defined to control how
long the <code class="highlighter-rouge">kubelet</code> must wait before transitioning out of a pressure condition.</p>

<ul>
  <li><code class="highlighter-rouge">eviction-pressure-transition-period</code> is the duration for which the <code class="highlighter-rouge">kubelet</code> has
to wait before transitioning out of an eviction pressure condition.</li>
</ul>

<p>The <code class="highlighter-rouge">kubelet</code> would ensure that it has not observed an eviction threshold being met
for the specified pressure condition for the period specified before toggling the
condition back to <code class="highlighter-rouge">false</code>.</p>

<h3 id="eviction-of-pods">Eviction of Pods</h3>

<p>If an eviction threshold has been met and the grace period has passed,
the <code class="highlighter-rouge">kubelet</code> will initiate the process of evicting pods until it has observed 
the signal has gone below its defined threshold.</p>

<p>The <code class="highlighter-rouge">kubelet</code> ranks pods for eviction 1) by their quality of service,
2) and among those with the same quality of service by the consumption of the
starved compute resource relative to the pods scheduling request.</p>

<ul>
  <li><code class="highlighter-rouge">BestEffort</code> pods that consume the most of the starved resource are failed
first.</li>
  <li><code class="highlighter-rouge">Burstable</code> pods that consume the greatest amount of the starved resource
relative to their request for that resource are killed first.  If no pod
has exceeded its request, the strategy targets the largest consumer of the
starved resource.</li>
  <li><code class="highlighter-rouge">Guaranteed</code> pods that consume the greatest amount of the starved resource
relative to their request are killed first.  If no pod has exceeded its request,
the strategy targets the largest consumer of the starved resource.</li>
</ul>

<p>A <code class="highlighter-rouge">Guaranteed</code> pod is guaranteed to never be evicted because of another pod’s
resource consumption.  If a system daemon (i.e. <code class="highlighter-rouge">kubelet</code>, <code class="highlighter-rouge">docker</code>, <code class="highlighter-rouge">journald</code>, etc.)
is consuming more resources than were reserved via <code class="highlighter-rouge">system-reserved</code> or <code class="highlighter-rouge">kube-reserved</code> allocations,
and the node only has <code class="highlighter-rouge">Guaranteed</code> pod(s) remaining, then the node must choose to evict a
<code class="highlighter-rouge">Guaranteed</code> pod in order to preserve node stability, and to limit the impact
of the unexpected consumption to other <code class="highlighter-rouge">Guaranteed</code> pod(s).</p>

<h3 id="scheduler">Scheduler</h3>

<p>The node will report a condition when a compute resource is under pressure.  The
scheduler views that condition as a signal to dissuade placing additional
pods on the node.</p>

<table>
  <thead>
    <tr>
      <th>Node Condition</th>
      <th>Scheduler Behavior</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">MemoryPressure</code></td>
      <td><code class="highlighter-rouge">BestEffort</code> pods are not scheduled to the node.</td>
    </tr>
  </tbody>
</table>

<h2 id="node-oom-behavior">Node OOM Behavior</h2>

<p>If the node experiences a system OOM (out of memory) event prior to the <code class="highlighter-rouge">kubelet</code> is able to reclaim memory,
the node depends on the <a href="https://lwn.net/Articles/391222/">oom_killer</a> to respond.</p>

<p>The <code class="highlighter-rouge">kubelet</code> sets a <code class="highlighter-rouge">oom_score_adj</code> value for each container based on the quality of service for the pod.</p>

<table>
  <thead>
    <tr>
      <th>Quality of Service</th>
      <th>oom_score_adj</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">Guaranteed</code></td>
      <td>-998</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">BestEffort</code></td>
      <td>1000</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">Burstable</code></td>
      <td>min(max(2, 1000 - (1000 * memoryRequestBytes) / machineMemoryCapacityBytes), 999)</td>
    </tr>
  </tbody>
</table>

<p>If the <code class="highlighter-rouge">kubelet</code> is unable to reclaim memory prior to a node experiencing system OOM, the <code class="highlighter-rouge">oom_killer</code> will calculate
an <code class="highlighter-rouge">oom_score</code> based on the percentage of memory its using on the node, and then add the <code class="highlighter-rouge">oom_score_adj</code> to get an
effective <code class="highlighter-rouge">oom_score</code> for the container, and then kills the container with the highest score.</p>

<p>The intended behavior should be that containers with the lowest quality of service that
are consuming the largest amount of memory relative to the scheduling request should be killed first in order
to reclaim memory.</p>

<p>Unlike pod eviction, if a pod container is OOM killed, it may be restarted by the <code class="highlighter-rouge">kubelet</code> based on its <code class="highlighter-rouge">RestartPolicy</code>.</p>

<h2 id="best-practices">Best Practices</h2>

<h3 id="schedulable-resources-and-eviction-policies">Schedulable resources and eviction policies</h3>

<p>Let’s imagine the following scenario:</p>

<ul>
  <li>Node memory capacity: <code class="highlighter-rouge">10Gi</code></li>
  <li>Operator wants to reserve 10% of memory capacity for system daemons (kernel, <code class="highlighter-rouge">kubelet</code>, etc.)</li>
  <li>Operator wants to evict pods at 95% memory utilization to reduce thrashing and incidence of system OOM.</li>
</ul>

<p>To facilitate this scenario, the <code class="highlighter-rouge">kubelet</code> would be launched as follows:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>--eviction-hard=memory.available&lt;500Mi
--system-reserved=memory=1.5Gi
</code></pre>
</div>

<p>Implicit in this configuration is the understanding that “System reserved” should include the amount of memory
covered by the eviction threshold.</p>

<p>To reach that capacity, either some pod is using more than its request, or the system is using more than <code class="highlighter-rouge">500Mi</code>.</p>

<p>This configuration will ensure that the scheduler does not place pods on a node that immediately induce memory pressure
and trigger eviction assuming those pods use less than their configured request.</p>

<h3 id="daemonset">DaemonSet</h3>

<p>It is never desired for a <code class="highlighter-rouge">kubelet</code> to evict a pod that was derived from
a <code class="highlighter-rouge">DaemonSet</code> since the pod will immediately be recreated and rescheduled
back to the same node.</p>

<p>At the moment, the <code class="highlighter-rouge">kubelet</code> has no ability to distinguish a pod created
from <code class="highlighter-rouge">DaemonSet</code> versus any other object.  If/when that information is
available, the <code class="highlighter-rouge">kubelet</code> could pro-actively filter those pods from the
candidate set of pods provided to the eviction strategy.</p>

<p>In general, it is strongly recommended that <code class="highlighter-rouge">DaemonSet</code> not
create <code class="highlighter-rouge">BestEffort</code> pods to avoid being identified as a candidate pod
for eviction. Instead <code class="highlighter-rouge">DaemonSet</code> should ideally launch <code class="highlighter-rouge">Guaranteed</code> pods.</p>

        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/out-of-resource.md?pixel" alt="Analytics" /></a>
        <div id="pd_rating_holder_8345992"></div>
		<script type="text/javascript">
	        PDRTJS_settings_8345992 = {
		        "id" : "8345992",
		        "unique_id" : "/docs/admin/out-of-resource/",
		        "title" : "Configuring Out Of Resource Handling",
		        "permalink" : "http://kubernetes.github.io/docs/admin/out-of-resource/"
	        };
	        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<div>
				<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
				<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
				<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			</div>
			<div>
				<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
				<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
				<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			</div>
			<div>
				<span>I wish this page</span>
				<input type="text" id="wishField" name="wishField" placeholder="enter your wish">
			</div>
		</div>
		<div id="miceType" class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>


<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
	.cse .gsc-control-cse, .gsc-control-cse, {
		padding: 0;
	}
	.gsc-control-cse table, .gsc-control-cse-en table {
		margin:0px !important;
	}

	.gsc-above-wrapper-area {
		border-bottom: 0;
	}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36037335-10', 'auto');
  ga('send', 'pageview');
</script>
<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
<!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->
</body>
</html>
