

<!Doctype html>
<html id="docs" class="Guides">


<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="canonical" href="http://kubernetes.io/docs/admin/federation/" />
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
        <link rel="stylesheet" href="/css/jquery-ui.min.css">
        <link rel="stylesheet" href="/css/sweetalert.css">
	<script src="/js/jquery-2.2.0.min.js"></script>
        <script src="/js/jquery-ui.min.js"></script>
	<script src="/js/script.js"></script>
        <script src="/js/sweetalert.min.js"></script>
	<title>Kubernetes - Federating Clusters</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a>
		<a href="/docs/hellonode/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/hellonode/">Get Started</a></h3>
				<p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
				<p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
			</div>
			<div class="nav-box">
				<h3><a href="/community/">Community</a></h3>
				<p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.kubernetes.io">Blog</a></h3>
				<p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
	<h1>Guides</h1>
	<h5>How to get started, and achieve tasks, using Kubernetes</h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/docs/" class="YAH">GUIDES</a></li>
			<li><a href="/docs/reference" >REFERENCE</a></li>
			<li><a href="/docs/samples" >SAMPLES</a></li>
			<li><a href="/docs/troubleshooting/" >SUPPORT</a></li>
		</ul>
		<div id="searchBox">
			<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
		</div>
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
        
    <a class="item" data-title="Guides" href="/docs/"></a>
<div class="item" data-title="Getting Started">
  <div class="container">
    <a class="item" data-title="What is Kubernetes?" href="/docs/whatisk8s/"></a>
    <a class="item" data-title="Downloading or Building Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    <a class="item" data-title="Hello World Walkthrough" href="/docs/hellonode/"></a>
    <a class="item" data-title="Online Training Course" href="https://www.udacity.com/course/scalable-microservices-with-kubernetes--ud615" target='_blank'></a>
  </div>
</div>
<div class="item" data-title="Accessing the Cluster">
  <div class="container">
    <a class="item" data-title="Installing and Setting up kubectl" href="/docs/user-guide/prereqs/"></a>
    <a class="item" data-title="Accessing Clusters" href="/docs/user-guide/accessing-the-cluster/"></a>
    <a class="item" data-title="Sharing Cluster Access with kubeconfig" href="/docs/user-guide/sharing-clusters/"></a>
    <a class="item" data-title="Authenticating Across Clusters with kubeconfig" href="/docs/user-guide/kubeconfig-file/"></a>
  </div>
</div>
    <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    <a class="item" data-title="Web UI (Dashboard)" href="/docs/user-guide/ui/"></a>
<div class="item" data-title="Workload Deployment and Management">
  <div class="container">
    <a class="item" data-title="Launching, Exposing, and Killing Applications" href="/docs/user-guide/quick-start/"></a>
    <a class="item" data-title="Deploying Applications" href="/docs/user-guide/deploying-applications/"></a>
    <a class="item" data-title="Managing Resources" href="/docs/user-guide/managing-deployments/"></a>
    <a class="item" data-title="Replication Controller Operations" href="/docs/user-guide/replication-controller/operations/"></a>
    <a class="item" data-title="Resizing a Replication Controller" href="/docs/user-guide/resizing-a-replication-controller/"></a>
    <a class="item" data-title="Rolling Updates" href="/docs/user-guide/rolling-updates/"></a>
    <a class="item" data-title="Rolling Update Demo" href="/docs/user-guide/update-demo/"></a>
    <a class="item" data-title="Secrets Walkthrough" href="/docs/user-guide/secrets/walkthrough/"></a>
    <a class="item" data-title="Using ConfigMap" href="/docs/user-guide/configmap/"></a>
    <a class="item" data-title="Horizontal Pod Autoscaling" href="/docs/user-guide/horizontal-pod-autoscaling/walkthrough/"></a>
    <a class="item" data-title="Best Practices for Configuration" href="/docs/user-guide/config-best-practices/"></a>
    <a class="item" data-title="Using kubectl to Manage Resources" href="/docs/user-guide/working-with-resources/"></a>
    <a class="item" data-title="Garbage collection" href="/docs/user-guide/garbage-collector/"></a>
  </div>
</div>
<div class="item" data-title="Batch Jobs">
  <div class="container">
    <a class="item" data-title="Jobs" href="/docs/user-guide/jobs/"></a>
    <a class="item" data-title="Parallel Processing using Expansions" href="/docs/user-guide/jobs/expansions/"></a>
    <a class="item" data-title="Coarse Parallel Processing using a Work Queue" href="/docs/user-guide/jobs/work-queue-1/"></a>
    <a class="item" data-title="Fine Parallel Processing using a Work Queue" href="/docs/user-guide/jobs/work-queue-2/"></a>
  </div>
</div>
<div class="item" data-title="Service Discovery and Load Balancing">
  <div class="container">
    <a class="item" data-title="Connecting Applications with Services" href="/docs/user-guide/connecting-applications/"></a>
    <a class="item" data-title="Service Operations" href="/docs/user-guide/services/operations/"></a>
    <a class="item" data-title="Creating an External Load Balancer" href="/docs/user-guide/load-balancer/"></a>
    <a class="item" data-title="Configuring Your Cloud Provider's Firewalls" href="/docs/user-guide/services-firewalls/"></a>
    <a class="item" data-title="Cross-cluster Service Discovery using Federated Services" href="/docs/user-guide/federation/federated-services/"></a>
  </div>
</div>
<div class="item" data-title="Containers and Pods">
  <div class="container">
    <a class="item" data-title="Running Your First Containers" href="/docs/user-guide/simple-nginx/"></a>
    <a class="item" data-title="Creating Single-Container Pods" href="/docs/user-guide/pods/single-container/"></a>
    <a class="item" data-title="Creating Multi-Container Pods" href="/docs/user-guide/pods/multi-container/"></a>
    <a class="item" data-title="Configuring Containers" href="/docs/user-guide/configuring-containers/"></a>
    <a class="item" data-title="Working with Containers in Production" href="/docs/user-guide/production-pods/"></a>
    <a class="item" data-title="Commands and Capabilities" href="/docs/user-guide/containers/"></a>
    <a class="item" data-title="Using Environment Variables" href="/docs/user-guide/environment-guide/"></a>
    <a class="item" data-title="Managing Compute Resources" href="/docs/user-guide/compute-resources/"></a>
    <a class="item" data-title="The Lifecycle of a Pod" href="/docs/user-guide/pod-states/"></a>
    <a class="item" data-title="Checking Pod Health" href="/docs/user-guide/liveness/"></a>
    <a class="item" data-title="Container Lifecycle Hooks" href="/docs/user-guide/container-environment/"></a>
    <a class="item" data-title="Assigning Pods to Nodes" href="/docs/user-guide/node-selection/"></a>
    <a class="item" data-title="Using the Downward API to Convey Pod Properties" href="/docs/user-guide/downward-api/"></a>
    <a class="item" data-title="Downward API Volumes" href="/docs/user-guide/downward-api/volume"></a>
    <a class="item" data-title="Persistent Volumes Walkthrough" href="/docs/user-guide/persistent-volumes/walkthrough/"></a>
    <a class="item" data-title="Bootstrapping Pet Sets" href="/docs/user-guide/petset/bootstrapping/"></a>
  </div>
</div>
<div class="item" data-title="Monitoring, Logging, and Debugging Containers">
  <div class="container">
    <a class="item" data-title="Resource Usage Monitoring" href="/docs/user-guide/monitoring/"></a>
    <a class="item" data-title="Logging" href="/docs/getting-started-guides/logging/"></a>
    <a class="item" data-title="Logging with Elasticsearch and Kibana" href="/docs/getting-started-guides/logging-elasticsearch/"></a>
    <a class="item" data-title="Running Commands in a Container with kubectl exec" href="/docs/user-guide/getting-into-containers/"></a>
    <a class="item" data-title="Connect with Proxies" href="/docs/user-guide/connecting-to-applications-proxy/"></a>
    <a class="item" data-title="Connect with Port Forwarding" href="/docs/user-guide/connecting-to-applications-port-forward/"></a>
    <a class="item" data-title="Using Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/explorer" target='_blank'></a>
  </div>
</div>
<div class="item" data-title="Creating a Cluster">
  <div class="container">
    <a class="item" data-title="Picking the Right Solution" href="/docs/getting-started-guides/"></a>
<div class="item" data-title="Running Kubernetes on Your Local Machine">
  <div class="container">
    <a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/getting-started-guides/minikube/"></a>
    <a class="item" data-title="Deprecated Alternatives" href="/docs/getting-started-guides/alternatives/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Turn-key Cloud Solutions">
  <div class="container">
    <a class="item" data-title="Running Kubernetes on Google Container Engine" href="https://cloud.google.com/container-engine/docs/before-you-begin/" target='_blank'></a>
    <a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/getting-started-guides/gce/"></a>
    <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    <a class="item" data-title="Running Kubernetes on Azure (Weave-based)" href="/docs/getting-started-guides/coreos/azure/"></a>
    <a class="item" data-title="Running Kubernetes on Azure (Flannel-based)" href="/docs/getting-started-guides/azure/"></a>
    <a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/getting-started-guides/clc/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Custom Solutions">
  <div class="container">
    <a class="item" data-title="Creating a Custom Cluster from Scratch" href="/docs/getting-started-guides/scratch/"></a>
<div class="item" data-title="Custom Cloud Solutions">
  <div class="container">
    <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Ubuntu on AWS or Joyent" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="CoreOS on Rackspace" href="/docs/getting-started-guides/rackspace/"></a>
  </div>
</div>
<div class="item" data-title="On-Premise VMs">
  <div class="container">
    <a class="item" data-title="CoreOS on Vagrant" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    <a class="item" data-title="VMware vSphere" href="/docs/getting-started-guides/vsphere/"></a>
    <a class="item" data-title="VMware Photon Controller" href="/docs/getting-started-guides/photon-controller/"></a>
    <a class="item" data-title="Juju" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    <a class="item" data-title="CoreOS on libvirt" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    <a class="item" data-title="OpenStack Heat" href="/docs/getting-started-guides/openstack-heat/"></a>
    <a class="item" data-title="CoreOS on Multinode Cluster" href="/docs/getting-started-guides/coreos/coreos_multinode_cluster/"></a>
    <a class="item" data-title="Fedora With Calico Networking" href="/docs/getting-started-guides/fedora/fedora-calico/"></a>
<div class="item" data-title="rkt">
  <div class="container">
    <a class="item" data-title="Running Kubernetes with rkt" href="/docs/getting-started-guides/rkt/"></a>
    <a class="item" data-title="Known Issues when Using rkt" href="/docs/getting-started-guides/rkt/notes/"></a>
  </div>
</div>
    <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
  </div>
</div>
<div class="item" data-title="Bare Metal">
  <div class="container">
    <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="CentOS" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    <a class="item" data-title="CoreOS" href="/docs/getting-started-guides/coreos"></a>
    <a class="item" data-title="CoreOS with Calico" href="/docs/getting-started-guides/coreos/bare_metal_calico/"></a>
    <a class="item" data-title="Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    <a class="item" data-title="Ubuntu Nodes with Calico" href="/docs/getting-started-guides/ubuntu-calico/"></a>
  </div>
</div>
  </div>
</div>
    <a class="item" data-title="Portable Multi-Node Cluster" href="/docs/getting-started-guides/docker-multinode/"></a>
    <a class="item" data-title="Building Large Clusters" href="/docs/admin/cluster-large/"></a>
    <a class="item" data-title="Running in Multiple Zones" href="/docs/admin/multiple-zones/"></a>
    <a class="item" data-title="Building High-Availability Clusters" href="/docs/admin/high-availability/"></a>
  </div>
</div>
<div class="item" data-title="Administering Clusters">
  <div class="container">
    <a class="item" data-title="Admin Guide" href="/docs/admin/"></a>
    <a class="item" data-title="Cluster Management Guide" href="/docs/admin/cluster-management/"></a>
    <a class="item" data-title="Sharing a Cluster with Namespaces" href="/docs/admin/namespaces/"></a>
    <a class="item" data-title="Namespaces Walkthrough" href="/docs/admin/namespaces/walkthrough/"></a>
    <a class="item" data-title="Setting Pod CPU and Memory Limits" href="/docs/admin/limitrange/"></a>
    <a class="item" data-title="Understanding Resource Quotas" href="/docs/admin/resourcequota/"></a>
    <a class="item" data-title="Applying Resource Quotas and Limits" href="/docs/admin/resourcequota/walkthrough/"></a>
    <a class="item" data-title="Kubernetes Components" href="/docs/admin/cluster-components/"></a>
    <a class="item" data-title="Configuring Kubernetes Use of etcd" href="/docs/admin/etcd/"></a>
    <a class="item" data-title="Federating Clusters" href="/docs/admin/federation/"></a>
    <a class="item" data-title="Using Multiple Clusters" href="/docs/admin/multi-cluster/"></a>
    <a class="item" data-title="Changing Cluster Size" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ#how-do-i-change-the-size-of-my-cluster/" target='_blank'></a>
    <a class="item" data-title="Configuring Multiple Schedulers" href="/docs/admin/multiple-schedulers/"></a>
    <a class="item" data-title="Networking in Kubernetes" href="/docs/admin/networking/"></a>
    <a class="item" data-title="Using DNS Pods and Services" href="/docs/admin/dns/"></a>
    <a class="item" data-title="Setting Up and Configuring DNS" href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/cluster-dns" target='_blank'></a>
    <a class="item" data-title="Master <-> Node Communication" href="/docs/admin/master-node-communication/"></a>
    <a class="item" data-title="Network Plugins" href="/docs/admin/network-plugins/"></a>
    <a class="item" data-title="Static Pods" href="/docs/admin/static-pods/"></a>
    <a class="item" data-title="Configuring kubelet Garbage Collection" href="/docs/admin/garbage-collection/"></a>
    <a class="item" data-title="Configuring Out Of Resource Handling" href="/docs/admin/out-of-resource/"></a>
    <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    <a class="item" data-title="Monitoring Node Health" href="/docs/admin/node-problem/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
		<button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
	</div> <!-- /docsToc -->
	<div id="docsContent">
        <p><a href="/editdocs#docs/admin/federation/index.md" id="editPageButton">Edit This Page</a></p>
    	<h1>Federating Clusters</h1>
		<p>This guide explains how to set up cluster federation that lets us control multiple Kubernetes clusters.</p>

<ul id="markdown-toc">
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#setting-up-a-federation-control-plane" id="markdown-toc-setting-up-a-federation-control-plane">Setting up a federation control plane</a>    <ul>
      <li><a href="#getting-images" id="markdown-toc-getting-images">Getting images</a>        <ul>
          <li><a href="#using-official-release-images" id="markdown-toc-using-official-release-images">Using official release images</a></li>
          <li><a href="#building-and-pushing-images-from-head" id="markdown-toc-building-and-pushing-images-from-head">Building and pushing images from HEAD</a></li>
        </ul>
      </li>
      <li><a href="#running-the-federation-control-plane" id="markdown-toc-running-the-federation-control-plane">Running the federation control plane</a></li>
    </ul>
  </li>
  <li><a href="#registering-kubernetes-clusters-for-federation" id="markdown-toc-registering-kubernetes-clusters-for-federation">Registering Kubernetes clusters for federation</a>    <ul>
      <li><a href="#updating-kubedns" id="markdown-toc-updating-kubedns">Updating KubeDNS</a></li>
    </ul>
  </li>
  <li><a href="#for-more-information" id="markdown-toc-for-more-information">For more information</a></li>
</ul>

<h2 id="prerequisites">Prerequisites</h2>

<p>This guide assumes that we have a running Kubernetes cluster.
If not, then head over to the <a href="/docs/getting-started-guides/">getting started guides</a> to bring up a cluster.</p>

<p>This guide also assumes that we have the Kubernetes source code that can be
<a href="/docs/getting-started-guides/binary_release/">downloaded from here</a>.</p>

<h2 id="setting-up-a-federation-control-plane">Setting up a federation control plane</h2>

<p>Setting up federation requires running the federation control plane which
consists of etcd, federation-apiserver and federation-controller-manager.
We can run these binaries as pods on an existing Kubernetes cluster.</p>

<h3 id="getting-images">Getting images</h3>

<p>To run these as pods, we first need images for all the components. We can use
official release images or we can build from HEAD.</p>

<h4 id="using-official-release-images">Using official release images</h4>

<p>As part of every release, images are pushed to <code class="highlighter-rouge">gcr.io/google_containers</code>. To use
these images, we set env var <code class="highlighter-rouge">FEDERATION_PUSH_REPO_BASE=gcr.io/google_containers</code>
This will always use the latest image.
To use federation-apiserver and federation-controller-manager images from a specific release, we can set <code class="highlighter-rouge">FEDERATION_IMAGE_TAG</code>.</p>

<h4 id="building-and-pushing-images-from-head">Building and pushing images from HEAD</h4>

<p>To run the code from HEAD, we need to build and push our own images.
We can build the images using the following command:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">FEDERATION</span><span class="o">=</span><span class="nb">true </span><span class="nv">KUBE_RELEASE_RUN_TESTS</span><span class="o">=</span>n make quick-release
</code></pre>
</div>

<p>Next, we need to push these images to a registry such as Google Container Registry or Docker Hub, so that our cluster can pull them.
If Kubernetes cluster is running on Google Compute Engine (GCE), then we can push the images to <code class="highlighter-rouge">gcr.io/&lt;gce-project-name&gt;</code>.
The command to push the images will look like:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">FEDERATION</span><span class="o">=</span><span class="nb">true </span><span class="nv">FEDERATION_PUSH_REPO_BASE</span><span class="o">=</span>gcr.io/&lt;gce-project-name&gt; ./build/push-federation-images.sh
</code></pre>
</div>

<h3 id="running-the-federation-control-plane">Running the federation control plane</h3>

<p>Once we have the images, we can run these as pods on our existing kubernetes cluster.
The command to run these pods on an existing GCE cluster will look like:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">KUBERNETES_PROVIDER</span><span class="o">=</span>gce <span class="nv">FEDERATION_DNS_PROVIDER</span><span class="o">=</span>google-clouddns <span class="nv">FEDERATION_NAME</span><span class="o">=</span>myfederation <span class="nv">DNS_ZONE_NAME</span><span class="o">=</span>myfederation.example <span class="nv">FEDERATION_PUSH_REPO_BASE</span><span class="o">=</span>gcr.io/google_containers ./federation/cluster/federation-up.sh
</code></pre>
</div>

<p><code class="highlighter-rouge">KUBERNETES_PROVIDER</code> is the cloud provider.</p>

<p><code class="highlighter-rouge">FEDERATION_DNS_PROVIDER</code> can be <code class="highlighter-rouge">google-clouddns</code> or <code class="highlighter-rouge">aws-route53</code>. It will be
set appropriately if it is missing and <code class="highlighter-rouge">KUBERNETES_PROVIDER</code> is one of <code class="highlighter-rouge">gce</code>, <code class="highlighter-rouge">gke</code> and <code class="highlighter-rouge">aws</code>.
This is used to resolve DNS requests for federation services. The service
controller keeps DNS records with the provider updated as services/pods are
updated in underlying kubernetes clusters.</p>

<p><code class="highlighter-rouge">FEDERATION_NAME</code> is a name we can choose for our federation. This is the name that will appear in DNS routes.</p>

<p><code class="highlighter-rouge">DNS_ZONE_NAME</code> is the domain to be used for DNS records. This is a domain that we
need to buy and then configure it such that DNS queries for that domain are
routed to the appropriate provider as per <code class="highlighter-rouge">FEDERATION_DNS_PROVIDER</code>.</p>

<p>Running that command creates a namespace <code class="highlighter-rouge">federation</code> and creates 2 deployments: <code class="highlighter-rouge">federation-apiserver</code> and <code class="highlighter-rouge">federation-controller-manager</code>.
We can verify that the pods are available by running the following command:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl get deployments --namespace<span class="o">=</span>federation
NAME                            DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
federation-apiserver            1         1         1            1           1m
federation-controller-manager   1         1         1            1           1m
</code></pre>
</div>

<p>Running <code class="highlighter-rouge">federation-up.sh</code> also creates a new record in our kubeconfig for us
to be able to talk to federation apiserver. We can view this by running
<code class="highlighter-rouge">kubectl config view</code>.</p>

<p>Note: <code class="highlighter-rouge">federation-up.sh</code> creates the federation-apiserver pod with an etcd
container that is backed by a persistent volume, so as to persist data. This
currently works only on AWS, GKE, and GCE.  You can edit
<code class="highlighter-rouge">federation/manifests/federation-apiserver-deployment.yaml</code> to suit your needs,
if required.</p>

<h2 id="registering-kubernetes-clusters-for-federation">Registering Kubernetes clusters for federation</h2>

<p>Now that we have the federation control plane up and running, we can start registering Kubernetes clusters.</p>

<p>First of all, we need to create a secret containing kubeconfig for that Kubernetes cluster, which federation control plane will use to talk to that Kubernetes cluster.
For now, we create this secret in the host Kubernetes cluster (that hosts federation control plane). When we start supporting secrets in federation control plane, we will create this secret there.
Suppose that our kubeconfig for Kubernetes cluster is at <code class="highlighter-rouge">/cluster1/kubeconfig</code>, we can run the following command to create the secret:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create secret generic cluster1 --namespace<span class="o">=</span>federation --from-file<span class="o">=</span>/cluster1/kubeconfig
</code></pre>
</div>

<p>Note that the file name should be <code class="highlighter-rouge">kubeconfig</code> since file name determines the name of the key in the secret.</p>

<p>Now that the secret is created, we are ready to register the cluster. The YAML file for cluster will look like:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">federation/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">Cluster</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">cluster1</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">serverAddressByClientCIDRs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">clientCIDR</span><span class="pi">:</span> <span class="s">&lt;client-cidr&gt;</span>
    <span class="s">serverAddress</span><span class="pi">:</span> <span class="s">&lt;apiserver-address&gt;</span>
  <span class="s">secretRef</span><span class="pi">:</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">&lt;secret-name&gt;</span>
</code></pre>
</div>

<p>We need to insert the appropriate values for <code class="highlighter-rouge">&lt;client-cidr&gt;</code>, <code class="highlighter-rouge">&lt;apiserver-address&gt;</code> and <code class="highlighter-rouge">&lt;secret-name&gt;</code>.
<code class="highlighter-rouge">&lt;secret-name&gt;</code> here is name of the secret that we just created.
serverAddressByClientCIDRs contains the various server addresses that clients
can use as per their CIDR. We can set the server’s public IP address with CIDR
<code class="highlighter-rouge">"0.0.0.0/0"</code> which all clients will match. In addition, if we want internal
clients to use server’s clusterIP, we can set that as serverAddress. The client
CIDR in that case will be a CIDR that only matches IPs of pods running in that
cluster.</p>

<p>Assuming our YAML file is located at <code class="highlighter-rouge">/cluster1/cluster.yaml</code>, we can run the following command to register this cluster:</p>

<!-- TODO(madhusudancs): Make the kubeconfig context configurable with default set to `federation` -->
<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl create -f /cluster1/cluster.yaml --context<span class="o">=</span>federation-cluster

</code></pre>
</div>

<p>By specifying <code class="highlighter-rouge">--context=federation-cluster</code>, we direct the request to federation apiserver.
we can ensure that the cluster registration was successful by running:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl get clusters --context<span class="o">=</span>federation-cluster
NAME       STATUS    VERSION   AGE
cluster1   Ready               3m
</code></pre>
</div>

<h3 id="updating-kubedns">Updating KubeDNS</h3>

<p>Once the cluster is registered with the federation, we are all ready to use it.
But for the cluster to be able to route federation service requests, we need to restart
KubeDNS and pass it a <code class="highlighter-rouge">--federations</code> flag which tells it about valid federation DNS hostnames.
Format of the flag is like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>--federations=${FEDERATION_NAME}=${DNS_DOMAIN_NAME}
</code></pre>
</div>

<p>To update KubeDNS with federations flag, we can edit the existing kubedns replication controller to
include that flag in pod template spec and then delete the existing pod. Replication controller will
recreate the pod with updated template.</p>

<p>To find the name of existing kubedns replication controller, run</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl get rc --namespace<span class="o">=</span>kube-system
</code></pre>
</div>

<p>This will list all the replication controllers. Name of the kube-dns replication
controller will look like <code class="highlighter-rouge">kube-dns-v18</code>. You can then edit it by running:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl edit rc &lt;rc-name&gt; --namespace<span class="o">=</span>kube-system
</code></pre>
</div>
<p>Add the <code class="highlighter-rouge">--federations</code> flag as args to kube-dns container in the YAML file that
pops up after running the above command.</p>

<p>To delete the existing kube dns pod, you can first find it by running:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl get pods --namespace<span class="o">=</span>kube-system
</code></pre>
</div>

<p>And then delete it by running:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl delete pods &lt;pod-name&gt; --namespace<span class="o">=</span>kube-system
</code></pre>
</div>

<p>We are now all set to start using federation.</p>

<h2 id="for-more-information">For more information</h2>

<ul>
  <li><a href="https://github.com/kubernetes/kubernetes/blob/master/docs/proposals/federation.md">Federation proposal</a> details use cases that motivated this work.</li>
</ul>

        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/federation/index.md?pixel" alt="Analytics" /></a>
        <div id="pd_rating_holder_8345992"></div>
		<script type="text/javascript">
	        PDRTJS_settings_8345992 = {
		        "id" : "8345992",
		        "unique_id" : "/docs/admin/federation/",
		        "title" : "Federating Clusters",
		        "permalink" : "http://kubernetes.github.io/docs/admin/federation/"
	        };
	        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<div>
				<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
				<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
				<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			</div>
			<div>
				<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
				<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
				<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			</div>
			<div>
				<span>I wish this page</span>
				<input type="text" id="wishField" name="wishField" placeholder="enter your wish">
			</div>
		</div>
		<div id="miceType" class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>


<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
	.cse .gsc-control-cse, .gsc-control-cse, {
		padding: 0;
	}
	.gsc-control-cse table, .gsc-control-cse-en table {
		margin:0px !important;
	}

	.gsc-above-wrapper-area {
		border-bottom: 0;
	}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36037335-10', 'auto');
  ga('send', 'pageview');
</script>
<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
<!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->
</body>
</html>
