

<!Doctype html>
<html id="docs" class="Guides">


<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="canonical" href="http://kubernetes.io/docs/admin/cluster-management/" />
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
        <link rel="stylesheet" href="/css/jquery-ui.min.css">
        <link rel="stylesheet" href="/css/sweetalert.css">
	<script src="/js/jquery-2.2.0.min.js"></script>
        <script src="/js/jquery-ui.min.js"></script>
	<script src="/js/script.js"></script>
        <script src="/js/sweetalert.min.js"></script>
	<title>Kubernetes - Cluster Management Guide</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a>
		<a href="/docs/hellonode/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/hellonode/">Get Started</a></h3>
				<p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
				<p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
			</div>
			<div class="nav-box">
				<h3><a href="/community/">Community</a></h3>
				<p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.kubernetes.io">Blog</a></h3>
				<p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
	<h1>Guides</h1>
	<h5>How to get started, and achieve tasks, using Kubernetes</h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/docs/" class="YAH">GUIDES</a></li>
			<li><a href="/docs/reference" >REFERENCE</a></li>
			<li><a href="/docs/samples" >SAMPLES</a></li>
			<li><a href="/docs/troubleshooting/" >SUPPORT</a></li>
		</ul>
		<div id="searchBox">
			<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
		</div>
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
        
    <a class="item" data-title="Guides" href="/docs/"></a>
<div class="item" data-title="Getting Started">
  <div class="container">
    <a class="item" data-title="What is Kubernetes?" href="/docs/whatisk8s/"></a>
    <a class="item" data-title="Downloading or Building Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    <a class="item" data-title="Hello World Walkthrough" href="/docs/hellonode/"></a>
    <a class="item" data-title="Online Training Course" href="https://www.udacity.com/course/scalable-microservices-with-kubernetes--ud615" target='_blank'></a>
  </div>
</div>
<div class="item" data-title="Accessing the Cluster">
  <div class="container">
    <a class="item" data-title="Installing and Setting up kubectl" href="/docs/user-guide/prereqs/"></a>
    <a class="item" data-title="Accessing Clusters" href="/docs/user-guide/accessing-the-cluster/"></a>
    <a class="item" data-title="Sharing Cluster Access with kubeconfig" href="/docs/user-guide/sharing-clusters/"></a>
    <a class="item" data-title="Authenticating Across Clusters with kubeconfig" href="/docs/user-guide/kubeconfig-file/"></a>
  </div>
</div>
    <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    <a class="item" data-title="Web UI (Dashboard)" href="/docs/user-guide/ui/"></a>
<div class="item" data-title="Workload Deployment and Management">
  <div class="container">
    <a class="item" data-title="Launching, Exposing, and Killing Applications" href="/docs/user-guide/quick-start/"></a>
    <a class="item" data-title="Deploying Applications" href="/docs/user-guide/deploying-applications/"></a>
    <a class="item" data-title="Managing Resources" href="/docs/user-guide/managing-deployments/"></a>
    <a class="item" data-title="Replication Controller Operations" href="/docs/user-guide/replication-controller/operations/"></a>
    <a class="item" data-title="Resizing a Replication Controller" href="/docs/user-guide/resizing-a-replication-controller/"></a>
    <a class="item" data-title="Rolling Updates" href="/docs/user-guide/rolling-updates/"></a>
    <a class="item" data-title="Rolling Update Demo" href="/docs/user-guide/update-demo/"></a>
    <a class="item" data-title="Secrets Walkthrough" href="/docs/user-guide/secrets/walkthrough/"></a>
    <a class="item" data-title="Using ConfigMap" href="/docs/user-guide/configmap/"></a>
    <a class="item" data-title="Horizontal Pod Autoscaling" href="/docs/user-guide/horizontal-pod-autoscaling/walkthrough/"></a>
    <a class="item" data-title="Best Practices for Configuration" href="/docs/user-guide/config-best-practices/"></a>
    <a class="item" data-title="Using kubectl to Manage Resources" href="/docs/user-guide/working-with-resources/"></a>
    <a class="item" data-title="Garbage collection" href="/docs/user-guide/garbage-collector/"></a>
  </div>
</div>
<div class="item" data-title="Batch Jobs">
  <div class="container">
    <a class="item" data-title="Jobs" href="/docs/user-guide/jobs/"></a>
    <a class="item" data-title="Parallel Processing using Expansions" href="/docs/user-guide/jobs/expansions/"></a>
    <a class="item" data-title="Coarse Parallel Processing using a Work Queue" href="/docs/user-guide/jobs/work-queue-1/"></a>
    <a class="item" data-title="Fine Parallel Processing using a Work Queue" href="/docs/user-guide/jobs/work-queue-2/"></a>
  </div>
</div>
<div class="item" data-title="Service Discovery and Load Balancing">
  <div class="container">
    <a class="item" data-title="Connecting Applications with Services" href="/docs/user-guide/connecting-applications/"></a>
    <a class="item" data-title="Service Operations" href="/docs/user-guide/services/operations/"></a>
    <a class="item" data-title="Creating an External Load Balancer" href="/docs/user-guide/load-balancer/"></a>
    <a class="item" data-title="Configuring Your Cloud Provider's Firewalls" href="/docs/user-guide/services-firewalls/"></a>
    <a class="item" data-title="Cross-cluster Service Discovery using Federated Services" href="/docs/user-guide/federation/federated-services/"></a>
  </div>
</div>
<div class="item" data-title="Containers and Pods">
  <div class="container">
    <a class="item" data-title="Running Your First Containers" href="/docs/user-guide/simple-nginx/"></a>
    <a class="item" data-title="Creating Single-Container Pods" href="/docs/user-guide/pods/single-container/"></a>
    <a class="item" data-title="Creating Multi-Container Pods" href="/docs/user-guide/pods/multi-container/"></a>
    <a class="item" data-title="Configuring Containers" href="/docs/user-guide/configuring-containers/"></a>
    <a class="item" data-title="Working with Containers in Production" href="/docs/user-guide/production-pods/"></a>
    <a class="item" data-title="Commands and Capabilities" href="/docs/user-guide/containers/"></a>
    <a class="item" data-title="Using Environment Variables" href="/docs/user-guide/environment-guide/"></a>
    <a class="item" data-title="Managing Compute Resources" href="/docs/user-guide/compute-resources/"></a>
    <a class="item" data-title="The Lifecycle of a Pod" href="/docs/user-guide/pod-states/"></a>
    <a class="item" data-title="Checking Pod Health" href="/docs/user-guide/liveness/"></a>
    <a class="item" data-title="Container Lifecycle Hooks" href="/docs/user-guide/container-environment/"></a>
    <a class="item" data-title="Assigning Pods to Nodes" href="/docs/user-guide/node-selection/"></a>
    <a class="item" data-title="Using the Downward API to Convey Pod Properties" href="/docs/user-guide/downward-api/"></a>
    <a class="item" data-title="Downward API Volumes" href="/docs/user-guide/downward-api/volume"></a>
    <a class="item" data-title="Persistent Volumes Walkthrough" href="/docs/user-guide/persistent-volumes/walkthrough/"></a>
    <a class="item" data-title="Bootstrapping Pet Sets" href="/docs/user-guide/petset/bootstrapping/"></a>
  </div>
</div>
<div class="item" data-title="Monitoring, Logging, and Debugging Containers">
  <div class="container">
    <a class="item" data-title="Resource Usage Monitoring" href="/docs/user-guide/monitoring/"></a>
    <a class="item" data-title="Logging" href="/docs/getting-started-guides/logging/"></a>
    <a class="item" data-title="Logging with Elasticsearch and Kibana" href="/docs/getting-started-guides/logging-elasticsearch/"></a>
    <a class="item" data-title="Running Commands in a Container with kubectl exec" href="/docs/user-guide/getting-into-containers/"></a>
    <a class="item" data-title="Connect with Proxies" href="/docs/user-guide/connecting-to-applications-proxy/"></a>
    <a class="item" data-title="Connect with Port Forwarding" href="/docs/user-guide/connecting-to-applications-port-forward/"></a>
    <a class="item" data-title="Using Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/explorer" target='_blank'></a>
  </div>
</div>
<div class="item" data-title="Creating a Cluster">
  <div class="container">
    <a class="item" data-title="Picking the Right Solution" href="/docs/getting-started-guides/"></a>
<div class="item" data-title="Running Kubernetes on Your Local Machine">
  <div class="container">
    <a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/getting-started-guides/minikube/"></a>
    <a class="item" data-title="Deprecated Alternatives" href="/docs/getting-started-guides/alternatives/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Turn-key Cloud Solutions">
  <div class="container">
    <a class="item" data-title="Running Kubernetes on Google Container Engine" href="https://cloud.google.com/container-engine/docs/before-you-begin/" target='_blank'></a>
    <a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/getting-started-guides/gce/"></a>
    <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    <a class="item" data-title="Running Kubernetes on Azure (Weave-based)" href="/docs/getting-started-guides/coreos/azure/"></a>
    <a class="item" data-title="Running Kubernetes on Azure (Flannel-based)" href="/docs/getting-started-guides/azure/"></a>
    <a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/getting-started-guides/clc/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Custom Solutions">
  <div class="container">
    <a class="item" data-title="Creating a Custom Cluster from Scratch" href="/docs/getting-started-guides/scratch/"></a>
<div class="item" data-title="Custom Cloud Solutions">
  <div class="container">
    <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Ubuntu on AWS or Joyent" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="CoreOS on Rackspace" href="/docs/getting-started-guides/rackspace/"></a>
  </div>
</div>
<div class="item" data-title="On-Premise VMs">
  <div class="container">
    <a class="item" data-title="CoreOS on Vagrant" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    <a class="item" data-title="VMware vSphere" href="/docs/getting-started-guides/vsphere/"></a>
    <a class="item" data-title="VMware Photon Controller" href="/docs/getting-started-guides/photon-controller/"></a>
    <a class="item" data-title="Juju" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    <a class="item" data-title="CoreOS on libvirt" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    <a class="item" data-title="OpenStack Heat" href="/docs/getting-started-guides/openstack-heat/"></a>
    <a class="item" data-title="CoreOS on Multinode Cluster" href="/docs/getting-started-guides/coreos/coreos_multinode_cluster/"></a>
    <a class="item" data-title="Fedora With Calico Networking" href="/docs/getting-started-guides/fedora/fedora-calico/"></a>
<div class="item" data-title="rkt">
  <div class="container">
    <a class="item" data-title="Running Kubernetes with rkt" href="/docs/getting-started-guides/rkt/"></a>
    <a class="item" data-title="Known Issues when Using rkt" href="/docs/getting-started-guides/rkt/notes/"></a>
  </div>
</div>
    <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
  </div>
</div>
<div class="item" data-title="Bare Metal">
  <div class="container">
    <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="CentOS" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    <a class="item" data-title="CoreOS" href="/docs/getting-started-guides/coreos"></a>
    <a class="item" data-title="CoreOS with Calico" href="/docs/getting-started-guides/coreos/bare_metal_calico/"></a>
    <a class="item" data-title="Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    <a class="item" data-title="Ubuntu Nodes with Calico" href="/docs/getting-started-guides/ubuntu-calico/"></a>
  </div>
</div>
  </div>
</div>
    <a class="item" data-title="Portable Multi-Node Cluster" href="/docs/getting-started-guides/docker-multinode/"></a>
    <a class="item" data-title="Building Large Clusters" href="/docs/admin/cluster-large/"></a>
    <a class="item" data-title="Running in Multiple Zones" href="/docs/admin/multiple-zones/"></a>
    <a class="item" data-title="Building High-Availability Clusters" href="/docs/admin/high-availability/"></a>
  </div>
</div>
<div class="item" data-title="Administering Clusters">
  <div class="container">
    <a class="item" data-title="Admin Guide" href="/docs/admin/"></a>
    <a class="item" data-title="Cluster Management Guide" href="/docs/admin/cluster-management/"></a>
    <a class="item" data-title="Sharing a Cluster with Namespaces" href="/docs/admin/namespaces/"></a>
    <a class="item" data-title="Namespaces Walkthrough" href="/docs/admin/namespaces/walkthrough/"></a>
    <a class="item" data-title="Setting Pod CPU and Memory Limits" href="/docs/admin/limitrange/"></a>
    <a class="item" data-title="Understanding Resource Quotas" href="/docs/admin/resourcequota/"></a>
    <a class="item" data-title="Applying Resource Quotas and Limits" href="/docs/admin/resourcequota/walkthrough/"></a>
    <a class="item" data-title="Kubernetes Components" href="/docs/admin/cluster-components/"></a>
    <a class="item" data-title="Configuring Kubernetes Use of etcd" href="/docs/admin/etcd/"></a>
    <a class="item" data-title="Federating Clusters" href="/docs/admin/federation/"></a>
    <a class="item" data-title="Using Multiple Clusters" href="/docs/admin/multi-cluster/"></a>
    <a class="item" data-title="Changing Cluster Size" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ#how-do-i-change-the-size-of-my-cluster/" target='_blank'></a>
    <a class="item" data-title="Configuring Multiple Schedulers" href="/docs/admin/multiple-schedulers/"></a>
    <a class="item" data-title="Networking in Kubernetes" href="/docs/admin/networking/"></a>
    <a class="item" data-title="Using DNS Pods and Services" href="/docs/admin/dns/"></a>
    <a class="item" data-title="Setting Up and Configuring DNS" href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/cluster-dns" target='_blank'></a>
    <a class="item" data-title="Master <-> Node Communication" href="/docs/admin/master-node-communication/"></a>
    <a class="item" data-title="Network Plugins" href="/docs/admin/network-plugins/"></a>
    <a class="item" data-title="Static Pods" href="/docs/admin/static-pods/"></a>
    <a class="item" data-title="Configuring kubelet Garbage Collection" href="/docs/admin/garbage-collection/"></a>
    <a class="item" data-title="Configuring Out Of Resource Handling" href="/docs/admin/out-of-resource/"></a>
    <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    <a class="item" data-title="Monitoring Node Health" href="/docs/admin/node-problem/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
		<button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
	</div> <!-- /docsToc -->
	<div id="docsContent">
        <p><a href="/editdocs#docs/admin/cluster-management.md" id="editPageButton">Edit This Page</a></p>
    	<h1>Cluster Management Guide</h1>
		<ul id="markdown-toc">
  <li><a href="#creating-and-configuring-a-cluster" id="markdown-toc-creating-and-configuring-a-cluster">Creating and configuring a Cluster</a></li>
  <li><a href="#upgrading-a-cluster" id="markdown-toc-upgrading-a-cluster">Upgrading a cluster</a>    <ul>
      <li><a href="#upgrading-google-compute-engine-clusters" id="markdown-toc-upgrading-google-compute-engine-clusters">Upgrading Google Compute Engine clusters</a></li>
      <li><a href="#upgrading-google-container-engine-gke-clusters" id="markdown-toc-upgrading-google-container-engine-gke-clusters">Upgrading Google Container Engine (GKE) clusters</a></li>
      <li><a href="#upgrading-clusters-on-other-platforms" id="markdown-toc-upgrading-clusters-on-other-platforms">Upgrading clusters on other platforms</a></li>
    </ul>
  </li>
  <li><a href="#resizing-a-cluster" id="markdown-toc-resizing-a-cluster">Resizing a cluster</a>    <ul>
      <li><a href="#cluster-autoscaling" id="markdown-toc-cluster-autoscaling">Cluster autoscaling</a></li>
    </ul>
  </li>
  <li><a href="#maintenance-on-a-node" id="markdown-toc-maintenance-on-a-node">Maintenance on a Node</a></li>
  <li><a href="#advanced-topics" id="markdown-toc-advanced-topics">Advanced Topics</a>    <ul>
      <li><a href="#upgrading-to-a-different-api-version" id="markdown-toc-upgrading-to-a-different-api-version">Upgrading to a different API version</a></li>
      <li><a href="#turn-on-or-off-an-api-version-for-your-cluster" id="markdown-toc-turn-on-or-off-an-api-version-for-your-cluster">Turn on or off an API version for your cluster</a></li>
      <li><a href="#switching-your-clusters-storage-api-version" id="markdown-toc-switching-your-clusters-storage-api-version">Switching your cluster’s storage API version</a></li>
      <li><a href="#switching-your-config-files-to-a-new-api-version" id="markdown-toc-switching-your-config-files-to-a-new-api-version">Switching your config files to a new API version</a></li>
    </ul>
  </li>
</ul>

<p>This document describes several topics related to the lifecycle of a cluster: creating a new cluster,
upgrading your cluster’s
master and worker nodes, performing node maintenance (e.g. kernel upgrades), and upgrading the Kubernetes API version of a
running cluster.</p>

<h2 id="creating-and-configuring-a-cluster">Creating and configuring a Cluster</h2>

<p>To install Kubernetes on a set of machines, consult one of the existing <a href="/docs/getting-started-guides/">Getting Started guides</a> depending on your environment.</p>

<h2 id="upgrading-a-cluster">Upgrading a cluster</h2>

<p>The current state of cluster upgrades is provider dependent.</p>

<h3 id="upgrading-google-compute-engine-clusters">Upgrading Google Compute Engine clusters</h3>

<p>Google Compute Engine Open Source (GCE-OSS) support master upgrades by deleting and
recreating the master, while maintaining the same Persistent Disk (PD) to ensure that data is retained across the
upgrade.</p>

<p>Node upgrades for GCE use a <a href="https://cloud.google.com/compute/docs/instance-groups/">Managed Instance Group</a>, each node
is sequentially destroyed and then recreated with new software.  Any Pods that are running on that node need to be
controlled by a Replication Controller, or manually re-created after the roll out.</p>

<p>Upgrades on open source Google Compute Engine (GCE) clusters are controlled by the <code class="highlighter-rouge">cluster/gce/upgrade.sh</code> script.</p>

<p>Get its usage by running <code class="highlighter-rouge">cluster/gce/upgrade.sh -h</code>.</p>

<p>For example, to upgrade just your master to a specific version (v1.0.2):</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>cluster/gce/upgrade.sh -M v1.0.2
</code></pre>
</div>

<p>Alternatively, to upgrade your entire cluster to the latest stable release:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>cluster/gce/upgrade.sh release/stable
</code></pre>
</div>

<h3 id="upgrading-google-container-engine-gke-clusters">Upgrading Google Container Engine (GKE) clusters</h3>

<p>Google Container Engine automatically updates master components (e.g. <code class="highlighter-rouge">kube-apiserver</code>, <code class="highlighter-rouge">kube-scheduler</code>) to the latest
version. It also handles upgrading the operating system and other components that the master runs on.</p>

<p>The node upgrade process is user-initiated and is described in the <a href="https://cloud.google.com/container-engine/docs/clusters/upgrade">GKE documentation.</a></p>

<h3 id="upgrading-clusters-on-other-platforms">Upgrading clusters on other platforms</h3>

<p>The <code class="highlighter-rouge">cluster/kube-push.sh</code> script will do a rudimentary update.  This process is still quite experimental, we
recommend testing the upgrade on an experimental cluster before performing the update on a production cluster.</p>

<h2 id="resizing-a-cluster">Resizing a cluster</h2>

<p>If your cluster runs short on resources you can easily add more machines to it if your cluster is running in <a href="/docs/admin/node/#self-registration-of-nodes">Node self-registration mode</a>.
If you’re using GCE or GKE it’s done by resizing Instance Group managing your Nodes. It can be accomplished by modifying number of instances on <code class="highlighter-rouge">Compute &gt; Compute Engine &gt; Instance groups &gt; your group &gt; Edit group</code> <a href="https://console.developers.google.com">Google Cloud Console page</a> or using gcloud CLI:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>gcloud compute instance-groups managed resize kubernetes-minion-group --size 42 --zone <span class="nv">$ZONE</span>
</code></pre>
</div>

<p>Instance Group will take care of putting appropriate image on new machines and start them, while Kubelet will register its Node with API server to make it available for scheduling. If you scale the instance group down, system will randomly choose Nodes to kill.</p>

<p>In other environments you may need to configure the machine yourself and tell the Kubelet on which machine API server is running.</p>

<h3 id="cluster-autoscaling">Cluster autoscaling</h3>

<p>If you are using GCE or GKE, you can configure your cluster so that it is automatically rescaled based on
pod needs.</p>

<p>As described in <a href="/docs/user-guide/compute-resources/">Compute Resource</a>, users can reserve how much CPU and memory is allocated to pods.
This information is used by the Kubernetes scheduler to find a place to run the pod. If there is
no node that has enough free capacity (or doesn’t match other pod requirements) then the pod has
to wait until some pods are terminated or a new node is added.</p>

<p>Cluster autoscaler looks for the pods that cannot be scheduled and checks if adding a new node, similar
to the other in the cluster, would help. If yes, then it resizes the cluster to accomodate the waiting pods.</p>

<p>Cluster autoscaler also scales down the cluster if it notices that some node is not needed anymore for
an extended period of time (10min but it may change in the future).</p>

<p>Cluster autoscaler is configured per instance group (GCE) or node pool (GKE).</p>

<p>If you are using GCE then you can either enable it while creating a cluster with kube-up.sh script. 
To configure cluser autoscaler you have to set 3 environment variables:</p>

<ul>
  <li><code class="highlighter-rouge">KUBE_ENABLE_CLUSTER_AUTOSCALER</code> - it enables cluster autoscaler if set to true.</li>
  <li><code class="highlighter-rouge">KUBE_AUTOSCALING_MIN_NODES</code> - minimum number of nodes in the cluster.</li>
  <li><code class="highlighter-rouge">KUBE_AUTOSCALING_MAX_NODES</code> - maximum number of nodes in the cluster.</li>
</ul>

<p>Example:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="nv">KUBE_ENABLE_CLUSTER_AUTOSCALER</span><span class="o">=</span><span class="nb">true </span><span class="nv">KUBE_AUTOSCALING_MIN_NODES</span><span class="o">=</span>3 <span class="nv">KUBE_AUTOSCALING_MAX_NODES</span><span class="o">=</span>10 <span class="nv">NUM_NODES</span><span class="o">=</span>5 ./cluster/kube-up.sh
</code></pre>
</div>

<p>On GKE you configure cluster autoscaler either on cluster creation or update or when creating a particular node pool
(which you want to be autoscaled) by passing flags <code class="highlighter-rouge">--enable-autoscaling</code> <code class="highlighter-rouge">--min-nodes</code> and <code class="highlighter-rouge">--max-nodes</code>
to the corresponding <code class="highlighter-rouge">gcloud</code> commands.</p>

<p>Examples:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>gcloud container clusters create mytestcluster --zone<span class="o">=</span>us-central1-b --enable-autoscaling<span class="o">=</span><span class="nb">true</span> --min-nodes<span class="o">=</span>3 --max-nodes<span class="o">=</span>10 --num-nodes<span class="o">=</span>5
</code></pre>
</div>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>gcloud container clusters update mytestcluster --enable-autoscaling<span class="o">=</span><span class="nb">true</span> --min-nodes<span class="o">=</span>1 --max-nodes<span class="o">=</span>15
</code></pre>
</div>

<p><strong>Cluster autoscaler expects that nodes have not been manually modified (e.g. by adding labels via kubectl) as those properties would not be propagated to the new nodes within the same instance group.</strong></p>

<h2 id="maintenance-on-a-node">Maintenance on a Node</h2>

<p>If you need to reboot a node (such as for a kernel upgrade, libc upgrade, hardware repair, etc.), and the downtime is
brief, then when the Kubelet restarts, it will attempt to restart the pods scheduled to it.  If the reboot takes longer
(the default time is 5 minutes, controlled by <code class="highlighter-rouge">--pod-eviction-timeout</code> on the controller-manager),
then the node controller will terminate the pods that are bound to the unavailable node.  If there is a corresponding
replica set (or replication controller), then a new copy of the pod will be started on a different node.  So, in the case where all
pods are replicated, upgrades can be done without special coordination, assuming that not all nodes will go down at the same time.</p>

<p>If you want more control over the upgrading process, you may use the following workflow:</p>

<p>Use <code class="highlighter-rouge">kubectl drain</code> to gracefully terminate all pods on the node while marking the node as unschedulable:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>kubectl drain <span class="nv">$NODENAME</span>
</code></pre>
</div>

<p>This keeps new pods from landing on the node while you are trying to get them off.</p>

<p>For pods with a replica set, the pod will be replaced by a new pod which will be scheduled to a new node. Additionally, if the pod is part of a service, then clients will automatically be redirected to the new pod.</p>

<p>For pods with no replica set, you need to bring up a new copy of the pod, and assuming it is not part of a service, redirect clients to it.</p>

<p>Perform maintenance work on the node.</p>

<p>Make the node schedulable again:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>kubectl uncordon <span class="nv">$NODENAME</span>
</code></pre>
</div>

<p>If you deleted the node’s VM instance and created a new one, then a new schedulable node resource will
be created automatically (if you’re using a cloud provider that supports
node discovery; currently this is only Google Compute Engine, not including CoreOS on Google Compute Engine using kube-register). See <a href="/docs/admin/node">Node</a> for more details.</p>

<h2 id="advanced-topics">Advanced Topics</h2>

<h3 id="upgrading-to-a-different-api-version">Upgrading to a different API version</h3>

<p>When a new API version is released, you may need to upgrade a cluster to support the new API version (e.g. switching from ‘v1’ to ‘v2’ when ‘v2’ is launched)</p>

<p>This is an infrequent event, but it requires careful management. There is a sequence of steps to upgrade to a new API version.</p>

<ol>
  <li>Turn on the new api version.</li>
  <li>Upgrade the cluster’s storage to use the new version.</li>
  <li>Upgrade all config files. Identify users of the old API version endpoints.</li>
  <li>Update existing objects in the storage to new version by running <code class="highlighter-rouge">cluster/update-storage-objects.sh</code>.</li>
  <li>Turn off the old API version.</li>
</ol>

<h3 id="turn-on-or-off-an-api-version-for-your-cluster">Turn on or off an API version for your cluster</h3>

<p>Specific API versions can be turned on or off by passing –runtime-config=api/  <version> flag while bringing up the API server. For example: to turn off v1 API, pass `--runtime-config=api/v1=false`. runtime-config also supports 2 special keys: api/all and api/legacy to control all and legacy APIs respectively. For example, for turning off all api versions except v1, pass `--runtime-config=api/all=false,api/v1=true`. For the purposes of these flags, _legacy_ APIs are those APIs which have been explicitly deprecated (e.g. `v1beta3`).</version>
</p>

<h3 id="switching-your-clusters-storage-api-version">Switching your cluster’s storage API version</h3>

<p>The objects that are stored to disk for a cluster’s internal representation of the Kubernetes resources active in the cluster are written using a particular version of the API.
When the supported API changes, these objects may need to be rewritten in the newer API.  Failure to do this will eventually result in resources that are no longer decodable or usable
by the kubernetes API server.</p>

<p><code class="highlighter-rouge">KUBE_API_VERSIONS</code> environment variable for the <code class="highlighter-rouge">kube-apiserver</code> binary which controls the API versions that are supported in the cluster. The first version in the list is used as the cluster’s storage version. Hence, to set a specific version as the storage version, bring it to the front of list of versions in the value of <code class="highlighter-rouge">KUBE_API_VERSIONS</code>.  You need to restart the <code class="highlighter-rouge">kube-apiserver</code> binary
for changes to this variable to take effect.</p>

<h3 id="switching-your-config-files-to-a-new-api-version">Switching your config files to a new API version</h3>

<p>You can use <code class="highlighter-rouge">kubectl convert</code> command to convert config files between different API versions.</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>kubectl convert -f pod.yaml --output-version v1
</code></pre>
</div>

<p>For more options, please refer to the usage of <a href="/docs/user-guide/kubectl/kubectl_convert/">kubectl convert</a> command.</p>

        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/cluster-management.md?pixel" alt="Analytics" /></a>
        <div id="pd_rating_holder_8345992"></div>
		<script type="text/javascript">
	        PDRTJS_settings_8345992 = {
		        "id" : "8345992",
		        "unique_id" : "/docs/admin/cluster-management/",
		        "title" : "Cluster Management Guide",
		        "permalink" : "http://kubernetes.github.io/docs/admin/cluster-management/"
	        };
	        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<div>
				<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
				<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
				<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			</div>
			<div>
				<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
				<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
				<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			</div>
			<div>
				<span>I wish this page</span>
				<input type="text" id="wishField" name="wishField" placeholder="enter your wish">
			</div>
		</div>
		<div id="miceType" class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>


<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
	.cse .gsc-control-cse, .gsc-control-cse, {
		padding: 0;
	}
	.gsc-control-cse table, .gsc-control-cse-en table {
		margin:0px !important;
	}

	.gsc-above-wrapper-area {
		border-bottom: 0;
	}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36037335-10', 'auto');
  ga('send', 'pageview');
</script>
<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
<!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->
</body>
</html>
