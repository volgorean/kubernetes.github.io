

<!Doctype html>
<html id="docs" class="Guides">


<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="canonical" href="http://kubernetes.io/docs/admin/node-problem/" />
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Mono' type='text/css'>
	<link rel="stylesheet" href="/css/styles.css"/>
        <link rel="stylesheet" href="/css/jquery-ui.min.css">
        <link rel="stylesheet" href="/css/sweetalert.css">
	<script src="/js/jquery-2.2.0.min.js"></script>
        <script src="/js/jquery-ui.min.js"></script>
	<script src="/js/script.js"></script>
        <script src="/js/sweetalert.min.js"></script>
	<title>Kubernetes - Monitoring Node Health</title>
</head>
<body>
<div id="cellophane" onclick="kub.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a>
		<a href="/docs/hellonode/" class="button" id="tryKubernetes" data-auto-burger-exclude>Try Kubernetes</a>
		<button id="hamburger" onclick="kub.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/hellonode/">Get Started</a></h3>
				<p>Ready to get your hands dirty? Build a simple Kubernetes cluster that runs "Hello World" for Node.js.</p>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
				<p>Learn how to use Kubernetes with the use of walkthroughs, samples, and reference documentation. You can even <a href="/editdocs/" data-auto-burger-exclude>help contribute to the docs</a>!</p>
			</div>
			<div class="nav-box">
				<h3><a href="/community/">Community</a></h3>
				<p>If you need help, you can connect with other Kubernetes users and the Kubernetes authors, attend community events, and watch video presentations from around the web.</p>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.kubernetes.io">Blog</a></h3>
				<p>Read the latest news for Kubernetes and the containers space in general, and get technical how-tos hot off the presses.</p>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="left">
				<h5 class="github-invite">Interested in hacking on the core Kubernetes code base?</h5>
				<a href="https://github.com/kubernetes/kubernetes" class="button" data-auto-burger-exclude>View On Github</a>
			</div>

			<div class="right">
				<h5 class="github-invite">Explore the community</h5>
				<div class="social">
					<a href="https://twitter.com/kubernetesio" class="twitter"><span>Twitter</span></a>
					<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
					<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
					<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
	<h1>Guides</h1>
	<h5>How to get started, and achieve tasks, using Kubernetes</h5>
	<div id="vendorStrip" class="light-text">
		<ul>
			<li><a href="/docs/" class="YAH">GUIDES</a></li>
			<li><a href="/docs/reference" >REFERENCE</a></li>
			<li><a href="/docs/samples" >SAMPLES</a></li>
			<li><a href="/docs/troubleshooting/" >SUPPORT</a></li>
		</ul>
		<div id="searchBox">
			<input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
		</div>
	</div>
</section>

<section id="encyclopedia">
	<div id="docsToc">
        <div class="pi-accordion">
        
    <a class="item" data-title="Guides" href="/docs/"></a>
<div class="item" data-title="Getting Started">
  <div class="container">
    <a class="item" data-title="What is Kubernetes?" href="/docs/whatisk8s/"></a>
    <a class="item" data-title="Downloading or Building Kubernetes" href="/docs/getting-started-guides/binary_release/"></a>
    <a class="item" data-title="Hello World Walkthrough" href="/docs/hellonode/"></a>
    <a class="item" data-title="Online Training Course" href="https://www.udacity.com/course/scalable-microservices-with-kubernetes--ud615" target='_blank'></a>
  </div>
</div>
<div class="item" data-title="Accessing the Cluster">
  <div class="container">
    <a class="item" data-title="Installing and Setting up kubectl" href="/docs/user-guide/prereqs/"></a>
    <a class="item" data-title="Accessing Clusters" href="/docs/user-guide/accessing-the-cluster/"></a>
    <a class="item" data-title="Sharing Cluster Access with kubeconfig" href="/docs/user-guide/sharing-clusters/"></a>
    <a class="item" data-title="Authenticating Across Clusters with kubeconfig" href="/docs/user-guide/kubeconfig-file/"></a>
  </div>
</div>
    <a class="item" data-title="User Guide" href="/docs/user-guide/"></a>
    <a class="item" data-title="Web UI (Dashboard)" href="/docs/user-guide/ui/"></a>
<div class="item" data-title="Workload Deployment and Management">
  <div class="container">
    <a class="item" data-title="Launching, Exposing, and Killing Applications" href="/docs/user-guide/quick-start/"></a>
    <a class="item" data-title="Deploying Applications" href="/docs/user-guide/deploying-applications/"></a>
    <a class="item" data-title="Managing Resources" href="/docs/user-guide/managing-deployments/"></a>
    <a class="item" data-title="Replication Controller Operations" href="/docs/user-guide/replication-controller/operations/"></a>
    <a class="item" data-title="Resizing a Replication Controller" href="/docs/user-guide/resizing-a-replication-controller/"></a>
    <a class="item" data-title="Rolling Updates" href="/docs/user-guide/rolling-updates/"></a>
    <a class="item" data-title="Rolling Update Demo" href="/docs/user-guide/update-demo/"></a>
    <a class="item" data-title="Secrets Walkthrough" href="/docs/user-guide/secrets/walkthrough/"></a>
    <a class="item" data-title="Using ConfigMap" href="/docs/user-guide/configmap/"></a>
    <a class="item" data-title="Horizontal Pod Autoscaling" href="/docs/user-guide/horizontal-pod-autoscaling/walkthrough/"></a>
    <a class="item" data-title="Best Practices for Configuration" href="/docs/user-guide/config-best-practices/"></a>
    <a class="item" data-title="Using kubectl to Manage Resources" href="/docs/user-guide/working-with-resources/"></a>
    <a class="item" data-title="Garbage collection" href="/docs/user-guide/garbage-collector/"></a>
  </div>
</div>
<div class="item" data-title="Batch Jobs">
  <div class="container">
    <a class="item" data-title="Jobs" href="/docs/user-guide/jobs/"></a>
    <a class="item" data-title="Parallel Processing using Expansions" href="/docs/user-guide/jobs/expansions/"></a>
    <a class="item" data-title="Coarse Parallel Processing using a Work Queue" href="/docs/user-guide/jobs/work-queue-1/"></a>
    <a class="item" data-title="Fine Parallel Processing using a Work Queue" href="/docs/user-guide/jobs/work-queue-2/"></a>
  </div>
</div>
<div class="item" data-title="Service Discovery and Load Balancing">
  <div class="container">
    <a class="item" data-title="Connecting Applications with Services" href="/docs/user-guide/connecting-applications/"></a>
    <a class="item" data-title="Service Operations" href="/docs/user-guide/services/operations/"></a>
    <a class="item" data-title="Creating an External Load Balancer" href="/docs/user-guide/load-balancer/"></a>
    <a class="item" data-title="Configuring Your Cloud Provider's Firewalls" href="/docs/user-guide/services-firewalls/"></a>
    <a class="item" data-title="Cross-cluster Service Discovery using Federated Services" href="/docs/user-guide/federation/federated-services/"></a>
  </div>
</div>
<div class="item" data-title="Containers and Pods">
  <div class="container">
    <a class="item" data-title="Running Your First Containers" href="/docs/user-guide/simple-nginx/"></a>
    <a class="item" data-title="Creating Single-Container Pods" href="/docs/user-guide/pods/single-container/"></a>
    <a class="item" data-title="Creating Multi-Container Pods" href="/docs/user-guide/pods/multi-container/"></a>
    <a class="item" data-title="Configuring Containers" href="/docs/user-guide/configuring-containers/"></a>
    <a class="item" data-title="Working with Containers in Production" href="/docs/user-guide/production-pods/"></a>
    <a class="item" data-title="Commands and Capabilities" href="/docs/user-guide/containers/"></a>
    <a class="item" data-title="Using Environment Variables" href="/docs/user-guide/environment-guide/"></a>
    <a class="item" data-title="Managing Compute Resources" href="/docs/user-guide/compute-resources/"></a>
    <a class="item" data-title="The Lifecycle of a Pod" href="/docs/user-guide/pod-states/"></a>
    <a class="item" data-title="Checking Pod Health" href="/docs/user-guide/liveness/"></a>
    <a class="item" data-title="Container Lifecycle Hooks" href="/docs/user-guide/container-environment/"></a>
    <a class="item" data-title="Assigning Pods to Nodes" href="/docs/user-guide/node-selection/"></a>
    <a class="item" data-title="Using the Downward API to Convey Pod Properties" href="/docs/user-guide/downward-api/"></a>
    <a class="item" data-title="Downward API Volumes" href="/docs/user-guide/downward-api/volume"></a>
    <a class="item" data-title="Persistent Volumes Walkthrough" href="/docs/user-guide/persistent-volumes/walkthrough/"></a>
    <a class="item" data-title="Bootstrapping Pet Sets" href="/docs/user-guide/petset/bootstrapping/"></a>
  </div>
</div>
<div class="item" data-title="Monitoring, Logging, and Debugging Containers">
  <div class="container">
    <a class="item" data-title="Resource Usage Monitoring" href="/docs/user-guide/monitoring/"></a>
    <a class="item" data-title="Logging" href="/docs/getting-started-guides/logging/"></a>
    <a class="item" data-title="Logging with Elasticsearch and Kibana" href="/docs/getting-started-guides/logging-elasticsearch/"></a>
    <a class="item" data-title="Running Commands in a Container with kubectl exec" href="/docs/user-guide/getting-into-containers/"></a>
    <a class="item" data-title="Connect with Proxies" href="/docs/user-guide/connecting-to-applications-proxy/"></a>
    <a class="item" data-title="Connect with Port Forwarding" href="/docs/user-guide/connecting-to-applications-port-forward/"></a>
    <a class="item" data-title="Using Explorer to Examine the Runtime Environment" href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/explorer" target='_blank'></a>
  </div>
</div>
<div class="item" data-title="Creating a Cluster">
  <div class="container">
    <a class="item" data-title="Picking the Right Solution" href="/docs/getting-started-guides/"></a>
<div class="item" data-title="Running Kubernetes on Your Local Machine">
  <div class="container">
    <a class="item" data-title="Running Kubernetes Locally via Minikube" href="/docs/getting-started-guides/minikube/"></a>
    <a class="item" data-title="Deprecated Alternatives" href="/docs/getting-started-guides/alternatives/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Turn-key Cloud Solutions">
  <div class="container">
    <a class="item" data-title="Running Kubernetes on Google Container Engine" href="https://cloud.google.com/container-engine/docs/before-you-begin/" target='_blank'></a>
    <a class="item" data-title="Running Kubernetes on Google Compute Engine" href="/docs/getting-started-guides/gce/"></a>
    <a class="item" data-title="Running Kubernetes on AWS EC2" href="/docs/getting-started-guides/aws/"></a>
    <a class="item" data-title="Running Kubernetes on Azure (Weave-based)" href="/docs/getting-started-guides/coreos/azure/"></a>
    <a class="item" data-title="Running Kubernetes on Azure (Flannel-based)" href="/docs/getting-started-guides/azure/"></a>
    <a class="item" data-title="Running Kubernetes on CenturyLink Cloud" href="/docs/getting-started-guides/clc/"></a>
  </div>
</div>
<div class="item" data-title="Running Kubernetes on Custom Solutions">
  <div class="container">
    <a class="item" data-title="Creating a Custom Cluster from Scratch" href="/docs/getting-started-guides/scratch/"></a>
<div class="item" data-title="Custom Cloud Solutions">
  <div class="container">
    <a class="item" data-title="CoreOS on AWS or GCE" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Ubuntu on AWS or Joyent" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="CoreOS on Rackspace" href="/docs/getting-started-guides/rackspace/"></a>
  </div>
</div>
<div class="item" data-title="On-Premise VMs">
  <div class="container">
    <a class="item" data-title="CoreOS on Vagrant" href="/docs/getting-started-guides/coreos/"></a>
    <a class="item" data-title="Cloudstack" href="/docs/getting-started-guides/cloudstack/"></a>
    <a class="item" data-title="VMware vSphere" href="/docs/getting-started-guides/vsphere/"></a>
    <a class="item" data-title="VMware Photon Controller" href="/docs/getting-started-guides/photon-controller/"></a>
    <a class="item" data-title="Juju" href="/docs/getting-started-guides/juju/"></a>
    <a class="item" data-title="DCOS" href="/docs/getting-started-guides/dcos/"></a>
    <a class="item" data-title="CoreOS on libvirt" href="/docs/getting-started-guides/libvirt-coreos/"></a>
    <a class="item" data-title="oVirt" href="/docs/getting-started-guides/ovirt/"></a>
    <a class="item" data-title="OpenStack Heat" href="/docs/getting-started-guides/openstack-heat/"></a>
    <a class="item" data-title="CoreOS on Multinode Cluster" href="/docs/getting-started-guides/coreos/coreos_multinode_cluster/"></a>
    <a class="item" data-title="Fedora With Calico Networking" href="/docs/getting-started-guides/fedora/fedora-calico/"></a>
<div class="item" data-title="rkt">
  <div class="container">
    <a class="item" data-title="Running Kubernetes with rkt" href="/docs/getting-started-guides/rkt/"></a>
    <a class="item" data-title="Known Issues when Using rkt" href="/docs/getting-started-guides/rkt/notes/"></a>
  </div>
</div>
    <a class="item" data-title="Kubernetes on Mesos" href="/docs/getting-started-guides/mesos/"></a>
    <a class="item" data-title="Kubernetes on Mesos on Docker" href="/docs/getting-started-guides/mesos-docker/"></a>
  </div>
</div>
<div class="item" data-title="Bare Metal">
  <div class="container">
    <a class="item" data-title="Offline" href="/docs/getting-started-guides/coreos/bare_metal_offline/"></a>
    <a class="item" data-title="Fedora via Ansible" href="/docs/getting-started-guides/fedora/fedora_ansible_config/"></a>
    <a class="item" data-title="Fedora (Single Node)" href="/docs/getting-started-guides/fedora/fedora_manual_config/"></a>
    <a class="item" data-title="Fedora (Multi Node)" href="/docs/getting-started-guides/fedora/flannel_multi_node_cluster/"></a>
    <a class="item" data-title="CentOS" href="/docs/getting-started-guides/centos/centos_manual_config/"></a>
    <a class="item" data-title="CoreOS" href="/docs/getting-started-guides/coreos"></a>
    <a class="item" data-title="CoreOS with Calico" href="/docs/getting-started-guides/coreos/bare_metal_calico/"></a>
    <a class="item" data-title="Ubuntu" href="/docs/getting-started-guides/ubuntu/"></a>
    <a class="item" data-title="Ubuntu Nodes with Calico" href="/docs/getting-started-guides/ubuntu-calico/"></a>
  </div>
</div>
  </div>
</div>
    <a class="item" data-title="Portable Multi-Node Cluster" href="/docs/getting-started-guides/docker-multinode/"></a>
    <a class="item" data-title="Building Large Clusters" href="/docs/admin/cluster-large/"></a>
    <a class="item" data-title="Running in Multiple Zones" href="/docs/admin/multiple-zones/"></a>
    <a class="item" data-title="Building High-Availability Clusters" href="/docs/admin/high-availability/"></a>
  </div>
</div>
<div class="item" data-title="Administering Clusters">
  <div class="container">
    <a class="item" data-title="Admin Guide" href="/docs/admin/"></a>
    <a class="item" data-title="Cluster Management Guide" href="/docs/admin/cluster-management/"></a>
    <a class="item" data-title="Sharing a Cluster with Namespaces" href="/docs/admin/namespaces/"></a>
    <a class="item" data-title="Namespaces Walkthrough" href="/docs/admin/namespaces/walkthrough/"></a>
    <a class="item" data-title="Setting Pod CPU and Memory Limits" href="/docs/admin/limitrange/"></a>
    <a class="item" data-title="Understanding Resource Quotas" href="/docs/admin/resourcequota/"></a>
    <a class="item" data-title="Applying Resource Quotas and Limits" href="/docs/admin/resourcequota/walkthrough/"></a>
    <a class="item" data-title="Kubernetes Components" href="/docs/admin/cluster-components/"></a>
    <a class="item" data-title="Configuring Kubernetes Use of etcd" href="/docs/admin/etcd/"></a>
    <a class="item" data-title="Federating Clusters" href="/docs/admin/federation/"></a>
    <a class="item" data-title="Using Multiple Clusters" href="/docs/admin/multi-cluster/"></a>
    <a class="item" data-title="Changing Cluster Size" href="https://github.com/kubernetes/kubernetes/wiki/User-FAQ#how-do-i-change-the-size-of-my-cluster/" target='_blank'></a>
    <a class="item" data-title="Configuring Multiple Schedulers" href="/docs/admin/multiple-schedulers/"></a>
    <a class="item" data-title="Networking in Kubernetes" href="/docs/admin/networking/"></a>
    <a class="item" data-title="Using DNS Pods and Services" href="/docs/admin/dns/"></a>
    <a class="item" data-title="Setting Up and Configuring DNS" href="https://github.com/kubernetes/kubernetes/tree/release-1.3/examples/cluster-dns" target='_blank'></a>
    <a class="item" data-title="Master <-> Node Communication" href="/docs/admin/master-node-communication/"></a>
    <a class="item" data-title="Network Plugins" href="/docs/admin/network-plugins/"></a>
    <a class="item" data-title="Static Pods" href="/docs/admin/static-pods/"></a>
    <a class="item" data-title="Configuring kubelet Garbage Collection" href="/docs/admin/garbage-collection/"></a>
    <a class="item" data-title="Configuring Out Of Resource Handling" href="/docs/admin/out-of-resource/"></a>
    <a class="item" data-title="Configuring Kubernetes with Salt" href="/docs/admin/salt/"></a>
    <a class="item" data-title="Monitoring Node Health" href="/docs/admin/node-problem/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
		<button class="push-menu-close-button" onclick="kub.toggleToc()"></button>
	</div> <!-- /docsToc -->
	<div id="docsContent">
        <p><a href="/editdocs#docs/admin/node-problem.md" id="editPageButton">Edit This Page</a></p>
    	<h1>Monitoring Node Health</h1>
		<ul id="markdown-toc">
  <li><a href="#node-problem-detector" id="markdown-toc-node-problem-detector">Node Problem Detector</a></li>
  <li><a href="#limitations" id="markdown-toc-limitations">Limitations</a></li>
  <li><a href="#enabledisable-in-gce-cluster" id="markdown-toc-enabledisable-in-gce-cluster">Enable/Disable in GCE cluster</a></li>
  <li><a href="#use-in-other-environment" id="markdown-toc-use-in-other-environment">Use in Other Environment</a>    <ul>
      <li><a href="#kubectl" id="markdown-toc-kubectl">Kubectl</a></li>
      <li><a href="#addon-pod" id="markdown-toc-addon-pod">Addon Pod</a></li>
    </ul>
  </li>
  <li><a href="#overwrite-the-configuration" id="markdown-toc-overwrite-the-configuration">Overwrite the Configuration</a></li>
  <li><a href="#kernel-monitor" id="markdown-toc-kernel-monitor">Kernel Monitor</a>    <ul>
      <li><a href="#add-new-nodeconditions" id="markdown-toc-add-new-nodeconditions">Add New NodeConditions</a></li>
      <li><a href="#detect-new-problems" id="markdown-toc-detect-new-problems">Detect New Problems</a></li>
      <li><a href="#change-log-path" id="markdown-toc-change-log-path">Change Log Path</a></li>
      <li><a href="#support-other-log-format" id="markdown-toc-support-other-log-format">Support Other Log Format</a></li>
    </ul>
  </li>
  <li><a href="#caveats" id="markdown-toc-caveats">Caveats</a></li>
</ul>

<h2 id="node-problem-detector">Node Problem Detector</h2>

<p><em>Node problem detector</em> is a <a href="/docs/admin/daemons/">DaemonSet</a> monitoring the
node health. It collects node problems from various daemons and reports them
to the apiserver as <a href="/docs/admin/node/#node-condition">NodeCondition</a> and
<a href="/docs/api-reference/v1/definitions/#_v1_event">Event</a>.</p>

<p>It supports some known kernel issue detection now, and will detect more and
more node problems over time.</p>

<p>Currently Kubernetes won’t take any action on the node conditions and events
generated by node problem detector. In the future, a remedy system could be
introduced to deal with node problems.</p>

<p>See more information
<a href="https://github.com/kubernetes/node-problem-detector">here</a>.</p>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>
    <p>The kernel issue detection of node problem detector only supports file based
kernel log now. It doesn’t support log tools like journald.</p>
  </li>
  <li>
    <p>The kernel issue detection of node problem detector has assumption on kernel
log format, now it only works on Ubuntu and Debian. However, it is easy to extend
it to <a href="/docs/admin/node-problem/#support-other-log-format">support other log format</a>.</p>
  </li>
</ul>

<h2 id="enabledisable-in-gce-cluster">Enable/Disable in GCE cluster</h2>

<p>Node problem detector is running as a cluster
<a href="docs/admin/cluster-large/#addon-resources">addon</a> enabled by default in the
gce cluster.</p>

<p>You can enable/disable it by setting the environment variable
<code class="highlighter-rouge">KUBE_ENABLE_NODE_PROBLEM_DETECTOR</code> before <code class="highlighter-rouge">kube-up.sh</code>.</p>

<h2 id="use-in-other-environment">Use in Other Environment</h2>

<p>To enable node problem detector in other environment outside of GCE, you can use
either <code class="highlighter-rouge">kubectl</code> or addon pod.</p>

<h3 id="kubectl">Kubectl</h3>

<p>This is the recommanded way to start node problem detector outside of GCE. It
provides more flexible management, such as overwriting the default
configuration to fit it into your environment or detect
customized node problems.</p>

<ul>
  <li><strong>Step 1:</strong> Create <code class="highlighter-rouge">node-problem-detector.yaml</code>:</li>
</ul>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">DaemonSet</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">node-problem-detector-v0.1</span>
  <span class="s">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">node-problem-detector</span>
    <span class="s">version</span><span class="pi">:</span> <span class="s">v0.1</span>
    <span class="s">kubernetes.io/cluster-service</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">node-problem-detector</span>
        <span class="s">version</span><span class="pi">:</span> <span class="s">v0.1</span>
        <span class="s">kubernetes.io/cluster-service</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">hostNetwork</span><span class="pi">:</span> <span class="s">true</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">node-problem-detector</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">gcr.io/google_containers/node-problem-detector:v0.1</span>
        <span class="s">securityContext</span><span class="pi">:</span>
          <span class="s">privileged</span><span class="pi">:</span> <span class="s">true</span>
        <span class="s">resources</span><span class="pi">:</span>
          <span class="s">limits</span><span class="pi">:</span>
            <span class="s">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200m"</span>
            <span class="s">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100Mi"</span>
          <span class="s">requests</span><span class="pi">:</span>
            <span class="s">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20m"</span>
            <span class="s">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20Mi"</span>
        <span class="s">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">log</span>
          <span class="s">mountPath</span><span class="pi">:</span> <span class="s">/log</span>
          <span class="s">readOnly</span><span class="pi">:</span> <span class="s">true</span>
      <span class="s">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">log</span>
        <span class="s">hostPath</span><span class="pi">:</span>
          <span class="s">path</span><span class="pi">:</span> <span class="s">/var/log/</span>
</code></pre>
</div>

<p><strong><em>Notice that you should make sure the system log directory is right for your
OS distro.</em></strong></p>

<ul>
  <li><strong>Step 2:</strong> Start node problem detector with <code class="highlighter-rouge">kubectl</code>:</li>
</ul>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>kubectl create -f node-problem-detector.yaml
</code></pre>
</div>

<h3 id="addon-pod">Addon Pod</h3>

<p>This is for those who have their own cluster bootstrap solution, and don’t need
to overwrite the default configuration. They could leverage the addon pod to
further automate the deployment.</p>

<p>Just create <code class="highlighter-rouge">node-problem-detector.yaml</code>, and put it under the addon pods directory
<code class="highlighter-rouge">/etc/kubernetes/addons/node-problem-detector</code> on master node.</p>

<h2 id="overwrite-the-configuration">Overwrite the Configuration</h2>

<p>The <a href="https://github.com/kubernetes/node-problem-detector/tree/v0.1/config">default configuration</a>
is embedded when building the docker image of node problem detector.</p>

<p>However, you can use <a href="/docs/user-guide/configmap/">ConfigMap</a> to overwrite it
following the steps:</p>

<ul>
  <li><strong>Step 1:</strong> Change the config files in <code class="highlighter-rouge">config/</code>.</li>
  <li><strong>Step 2:</strong> Create the ConfigMap <code class="highlighter-rouge">node-problem-detector-config</code> with <code class="highlighter-rouge">kubectl  create configmap
node-problem-detector-config --from-file=config/</code>.</li>
  <li><strong>Step 3:</strong> Change the <code class="highlighter-rouge">node-problem-detector.yaml</code> to use the ConfigMap:</li>
</ul>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">apiVersion</span><span class="pi">:</span> <span class="s">extensions/v1beta1</span>
<span class="s">kind</span><span class="pi">:</span> <span class="s">DaemonSet</span>
<span class="s">metadata</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">node-problem-detector-v0.1</span>
  <span class="s">namespace</span><span class="pi">:</span> <span class="s">kube-system</span>
  <span class="s">labels</span><span class="pi">:</span>
    <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">node-problem-detector</span>
    <span class="s">version</span><span class="pi">:</span> <span class="s">v0.1</span>
    <span class="s">kubernetes.io/cluster-service</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
<span class="s">spec</span><span class="pi">:</span>
  <span class="s">template</span><span class="pi">:</span>
    <span class="s">metadata</span><span class="pi">:</span>
      <span class="s">labels</span><span class="pi">:</span>
        <span class="s">k8s-app</span><span class="pi">:</span> <span class="s">node-problem-detector</span>
        <span class="s">version</span><span class="pi">:</span> <span class="s">v0.1</span>
        <span class="s">kubernetes.io/cluster-service</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
    <span class="s">spec</span><span class="pi">:</span>
      <span class="s">hostNetwork</span><span class="pi">:</span> <span class="s">true</span>
      <span class="s">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">node-problem-detector</span>
        <span class="s">image</span><span class="pi">:</span> <span class="s">gcr.io/google_containers/node-problem-detector:v0.1</span>
        <span class="s">securityContext</span><span class="pi">:</span>
          <span class="s">privileged</span><span class="pi">:</span> <span class="s">true</span>
        <span class="s">resources</span><span class="pi">:</span>
          <span class="s">limits</span><span class="pi">:</span>
            <span class="s">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200m"</span>
            <span class="s">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">100Mi"</span>
          <span class="s">requests</span><span class="pi">:</span>
            <span class="s">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20m"</span>
            <span class="s">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">20Mi"</span>
        <span class="s">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">log</span>
          <span class="s">mountPath</span><span class="pi">:</span> <span class="s">/log</span>
          <span class="s">readOnly</span><span class="pi">:</span> <span class="s">true</span>
        <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">config</span> <span class="c1"># Overwrite the config/ directory with ConfigMap volume</span>
          <span class="s">mountPath</span><span class="pi">:</span> <span class="s">/config</span>
          <span class="s">readOnly</span><span class="pi">:</span> <span class="s">true</span>
      <span class="s">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">log</span>
        <span class="s">hostPath</span><span class="pi">:</span>
          <span class="s">path</span><span class="pi">:</span> <span class="s">/var/log/</span>
      <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s">config</span> <span class="c1"># Define ConfigMap volume</span>
        <span class="s">configMap</span><span class="pi">:</span>
          <span class="s">name</span><span class="pi">:</span> <span class="s">node-problem-detector-config</span>
</code></pre>
</div>

<ul>
  <li><strong>Step 4:</strong> Re-create the node problem detector with the new yaml file:</li>
</ul>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>kubectl delete -f node-problem-detector.yaml <span class="c"># If you have a node-problem-detector running</span>
kubectl create -f node-problem-detector.yaml
</code></pre>
</div>

<p><strong><em>Notice that this approach only applies to node problem detector started with <code class="highlighter-rouge">kubectl</code>.</em></strong></p>

<p>For node problem detector running as cluster addon, because addon manager doesn’t support
ConfigMap, configuration overwriting is not supported now.</p>

<h2 id="kernel-monitor">Kernel Monitor</h2>

<p><em>Kernel Monitor</em> is a problem daemon in node problem detector. It monitors kernel log
and detects known kernel issues following predefined rules.</p>

<p>The Kernel Monitor matches kernel issues according to a set of predefined rule list in
<a href="https://github.com/kubernetes/node-problem-detector/blob/v0.1/config/kernel-monitor.json"><code class="highlighter-rouge">config/kernel-monitor.json</code></a>.
The rule list is extensible, you can always extend it by <a href="/docs/admin/node-problem/#overwrite-the-configuration">overwriting the
configuration</a>.</p>

<h3 id="add-new-nodeconditions">Add New NodeConditions</h3>

<p>To support new node conditions, you can extend the <code class="highlighter-rouge">conditions</code> field in
<code class="highlighter-rouge">config/kernel-monitor.json</code> with new condition definition:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NodeConditionType"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CamelCaseDefaultNodeConditionReason"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arbitrary default node condition message"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="detect-new-problems">Detect New Problems</h3>

<p>To detect new problems, you can extend the <code class="highlighter-rouge">rules</code> field in <code class="highlighter-rouge">config/kernel-monitor.json</code>
with new rule definition:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"temporary/permanent"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"condition"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NodeConditionOfPermanentIssue"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CamelCaseShortReason"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"regexp matching the issue in the kernel log"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="change-log-path">Change Log Path</h3>

<p>Kernel log in different OS distros may locate in different path. The <code class="highlighter-rouge">log</code>
field in <code class="highlighter-rouge">config/kernel-monitor.json</code> is the log path inside the container.
You can always configure it to match your OS distro.</p>

<h3 id="support-other-log-format">Support Other Log Format</h3>

<p>Kernel monitor uses <a href="https://github.com/kubernetes/node-problem-detector/blob/v0.1/pkg/kernelmonitor/translator/translator.go"><code class="highlighter-rouge">Translator</code></a>
plugin to translate kernel log the internal data structure. It is easy to
implement a new translator for a new log format.</p>

<h2 id="caveats">Caveats</h2>

<p>It is recommanded to run the node problem detector in your cluster to monitor
the node health. However, you should be aware that this will introduce extra
resource overhead on each node. Usually this is fine, because:</p>

<ul>
  <li>The kernel log is generated relatively slowly.</li>
  <li>Resource limit is set for node problem detector.</li>
  <li>Even under high load, the resource usage is acceptable.
(see <a href="https://github.com/kubernetes/node-problem-detector/issues/2#issuecomment-220255629">benchmark result</a>)</li>
</ul>

        <p><a href=""><img src="https://kubernetes-site.appspot.com/UA-36037335-10/GitHub/docs/admin/node-problem.md?pixel" alt="Analytics" /></a>
        <div id="pd_rating_holder_8345992"></div>
		<script type="text/javascript">
	        PDRTJS_settings_8345992 = {
		        "id" : "8345992",
		        "unique_id" : "/docs/admin/node-problem/",
		        "title" : "Monitoring Node Health",
		        "permalink" : "http://kubernetes.github.io/docs/admin/node-problem/"
	        };
	        (function(d,c,j){if(!document.getElementById(j)){var pd=d.createElement(c),s;pd.id=j;pd.src=('https:'==document.location.protocol)?'https://polldaddy.com/js/rating/rating.js':'http://i0.poll.fm/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd,s);}}(document,'script','pd-rating-js'));
        </script>
	</div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/hellonode/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="http://blog.kubernetes.io/">Blog</a>
			<a href="/community/">Community</a>
		</nav>
		<div class="social">
			<div>
				<a href="https://twitter.com/kubernetesio" class="twitter"><span>twitter</span></a>
				<a href="https://github.com/kubernetes/kubernetes" class="github"><span>Github</span></a>
				<a href="http://slack.k8s.io/" class="slack"><span>Slack</span></a>
			</div>
			<div>
				<a href="http://stackoverflow.com/questions/tagged/kubernetes" class="stack-overflow"><span>Stack Overflow</span></a>
				<a href="https://groups.google.com/forum/#!forum/kubernetes-users" class="mailing-list"><span>Mailing List</span></a>
				<a href="https://calendar.google.com/calendar/embed?src=nt2tcnbtbied3l6gi2h29slvc0%40group.calendar.google.com" class="calendar"><span>Events Calendar</span></a>
			</div>
			<div>
				<span>I wish this page</span>
				<input type="text" id="wishField" name="wishField" placeholder="enter your wish">
			</div>
		</div>
		<div id="miceType" class="center">&copy; 2016 Kubernetes</div>
	</main>
</footer>


<button class="flyout-button" onclick="kub.toggleToc()"></button>

<style>
	.cse .gsc-control-cse, .gsc-control-cse, {
		padding: 0;
	}
	.gsc-control-cse table, .gsc-control-cse-en table {
		margin:0px !important;
	}

	.gsc-above-wrapper-area {
		border-bottom: 0;
	}
</style>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36037335-10', 'auto');
  ga('send', 'pageview');
</script>
<!-- Commenting out AnswerDash for now; we need to work on our list of questions/answers/design first
<!-- Start of AnswerDash script <script>var AnswerDash;!function(e,t,n,s,a){if(!t.getElementById(s)){var i,r=t.createElement(n),c=t.getElementsByTagName(n)[0];e[a]||(i=e[a]=function(){i.__oninit.push(arguments)},i.__oninit=[]),r.type="text/javascript",r.async=!0,r.src="https://p1.answerdash.com/answerdash.min.js?siteid=756",r.setAttribute("id",s),c.parentNode.insertBefore(r,c)}}(window,document,"script","answerdash-script","AnswerDash");</script> <!-- End of AnswerDash script -->
</body>
</html>
